var MEvent=new function(){var t,i=!1,e=[],o=document.createElement("div"),n=function(){for(var t=0,i=e.length;t<i;t++)e[t].apply(document);e=null},s={transitionend:{webkit:"webkitTransitionEnd",Moz:"transitionend",O:"oTransitionEnd",ms:"MSTransitionEnd"}},a=function(e){i||(i=!0,n.call(window),document.removeEventListener?document.removeEventListener("DOMContentLoaded",a,!1):document.detachEvent&&(document.detachEvent("onreadystatechange",a),window==window.top&&(clearInterval(t),t=null)))};document.addEventListener?document.addEventListener("DOMContentLoaded",a,!1):document.attachEvent&&(document.attachEvent("onreadystatechange",function(){new RegExp("loaded|complete").test(document.readyState)&&a()}),window==window.top&&(t=setInterval(function(){try{i||document.documentElement.doScroll("left")}catch(t){return}a()},0))),this.Events={transitionend:function(){var t="transitionend";return Object.keys(s.transitionend).some(function(i){if(i+"TransitionProperty"in o.style)return t=s.transitionend[i],!0}),t}()},this.ready=function(t,o){i?t.call(o||window):e.push(function(){return t.call(o||window)})};var r=function(t,i,e,o,n,s){var a;e._one=!!s;var r=function(s){s=s||window.event,a={e:s,target:t,type:i,data:n,preventDefault:function(){this.e&&MEvent.stopDefault(this.e)},stopPropagation:function(){this.e&&MEvent.stopPropagation(this.e)}},e.apply(o?o:t,[a]),e._one&&MEvent.unbind(t,i,e)};return r._p_=e,r._obj=t,r._context=o,r._data=n,r};this.eventSupported=function(t,i){if(void 0==t||"string"!=typeof t)return!1;i=i||MElement.create("div"),t="on"+t;var e=t in i;return i.setAttribute&&!e&&(i.setAttribute(t,"return;"),e="function"==typeof i[t]),i=null,e},this.stopDefault=function(t){if(t){if(t.target&&!0===MElement.hasClass(t.target,"MInfoWindow"))return;t.preventDefault?t.preventDefault():t.returnValue=!1}},this.stopPropagation=function(t){t&&(t.stopPropagation?t.stopPropagation():t.cancelBubble=!0)},this.one=function(t,i,e,o,n){this.bind(t,i,e,o,n,!0)},this.bind=function(t,i,e,o,n,s){t=MElement.$(t);var a,h,l=MElement.isElement(t);if(t.adapters||(t.adapters={}),l){t.adapters[i]||(t.adapters[i]=[]),a=r(t,i,e,o,n,s),h=!1;for(var p=0,_=t.adapters[i].length;p<_;p++)if(t.adapters[i][p]._p_===a._p_){h=!0;break}h||(t.adapters[i].push(a),t.addEventListener?t.addEventListener(i,a,!1):t.attachEvent&&t.attachEvent("on"+i,a))}else{t.adapters[i]||(t.adapters[i]=[]),h=!1;for(var d=0,c=t.adapters[i].length;d<c;d++)if(t.adapters[i][d].fun===e&&t.adapters[i][d].context===o){h=!0;break}h||t.adapters[i].push({fun:e,context:o,data:n,one:!!s})}},this.unbind=function(t,i,e,o){if(t){t=MElement.$(t);var n,s,a,r,h=MElement.isElement(t),l=[],p=[];if(h){if(i&&e&&t.adapters&&t.adapters[i]){a=t.adapters[i],n=-1;for(var _=0,d=a.length;_<d;_++)if(e==a[_]._p_){n=_;break}n>-1&&(s=a[n],t.removeEventListener?t.removeEventListener(i,s,!1):t.detachEvent&&t.detachEvent("on"+i,s),delete a[n],a.splice(n,1),0==a.length&&delete t.adapters[i])}else if(i&&!e&&t.adapters&&t.adapters[i]){a=t.adapters[i];for(var c=0,u=a.length;c<u;c++)l.push(a[c]._p_);for(var M=0,f=l.length;M<f;M++)this.unbind(t,i,l[M])}else if(!i&&t.adapters){for(var m in t.adapters)t.adapters.hasOwnProperty(m)&&p.push(m.toString());for(var g=0,y=p.length;g<y;g++)this.unbind(t,p[g]);delete t.adapters}}else if(i&&e&&t.adapters&&t.adapters[i]){r=t.adapters[i],n=-1;for(var v=0,w=r.length;v<w;v++)if((!o||o===r[v].context)&&e===r[v].fun){n=v;break}r.splice(n,1),0==r.length&&delete t.adapters[i]}else i&&!e&&t.adapters&&t.adapters[i]?delete t.adapters[i]:!i&&t.adapters&&delete t.adapters}},this.clear=function(t,i){this.unbind(t,i)},this.trigger=function(t,i){t=MElement.$(t);var e,o,n=MElement.isElement(t);if(t.adapters&&t.adapters[i])if(e=t.adapters[i],n)for(var s=0,a=e.length;s<a;s++)o=e[s],o._p_.apply(o._context?o._context:o._obj,[{target:t,type:i,preventDefault:function(){},stopPropagation:function(){},data:o._data}].concat(Array.prototype.slice.apply(arguments).slice(2))),o._p_._one&&MEvent.unbind(t,i,o._p_);else for(var r=0,h=e.length;r<h;r++)o=e[r].fun,o.apply(e[r].context?e[r].context:t,[{target:t,type:i,data:e[r].data}].concat(Array.prototype.slice.apply(arguments).slice(2))),e[r].one&&MEvent.unbind(t,i,o)},this.mouseWheel=function(t,i,e,o){this.bind(t,this.eventSupported("mousewheel")?"mousewheel":"DOMMouseScroll",function(t){var e=t.e,o=0;e.wheelDelta?(o=e.wheelDelta/120,window.opera&&window.opera.version()<10&&(o=-o)):e.detail&&(o=-e.detail/3),e.delta=Math.round(o),i.apply(this,[t])},e,o)}},MTools=new function(){var _ua=navigator.userAgent.toLowerCase(),_s,_hiddenDom,_supportCanvas,_createHiddenDom=function(){_hiddenDom||(_hiddenDom=document.createElement("div"),_hiddenDom.setAttribute("style","position:absolute;float:left;left:-10000px;top:-10000px;"),document.body.appendChild(_hiddenDom))};String.repeat||(String.repeat=function(t){return new Array(t+1).join(this)}),String.trim||(String.trim=function(){return this.replace(new RegExp("^\\s+|\\s+$","g"),"")}),Function.prototype.bind||(Function.prototype.bind=function(t){var i=Array.prototype.slice.call(arguments,1),e=this;return function(){return e.apply(t,i.concat(Array.prototype.slice.call(arguments)))}});var _EP_KEY=6,_CSL_RIGHT=2,_CSL_TOP=8,_CSL_BOTTOM=4,_CSL_LEFT=1,_argsToArray=function(t){return Array.prototype.slice.apply(t)},_obj2url=function(t){var i=[];for(var e in t){var o=typeof t[e];!t.hasOwnProperty(e)||"string"!=o&&"number"!=o||i.push(e+"="+t[e])}return i.join("&")},_serialNumber=function(){return Math.random().toString().replace(new RegExp("^0\\."),"")},_setContextOptions=function(t,i){for(var e in i)e in t&&(t[e]=i[e])};this.browser={},(_s=_ua.match(new RegExp("android ([\\d.]+);")))?this.browser.android=_s[1]:(_s=_ua.match(new RegExp("cpu iphone os ([\\d_]+)")))?this.browser.iphone=_s[1]:(_s=_ua.match(new RegExp("ipad; cpu os ([\\d_]+)")))?this.browser.ipad=_s[1]:0,(_s=_ua.match(new RegExp("msie ([\\d.]+)")))?this.browser.msie=_s[1]:(_s=_ua.match(new RegExp("firefox/([\\d.]+)")))?this.browser.firefox=_s[1]:(_s=_ua.match(new RegExp("chrome/([\\d.]+)")))?this.browser.chrome=_s[1]:(_s=_ua.match(new RegExp("opera.([\\d.]+)")))?this.browser.opera=_s[1]:(_s=_ua.match(new RegExp("version/([\\d.]+).*safari")))?this.browser.safari=_s[1]:0,this.supportSVG=!!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect,this.supportRequestAnimationFrame=!!(window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame),window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(t){setTimeout(t,1e3/60)},this.loops={},this.browserKernel={},this.between=function(t,i,e,o){return"number"!=typeof t||"number"!=typeof i||"number"!=typeof e?o:t<i||t>e?o:t},this.supportTouch=function(){return"ontouchstart"in document.body},this.cohenSutherland=function(t,i){var e,o,n,s=function(t,i,e,o,n,s){var a=0;return i>s?a|=_CSL_TOP:i<o&&(a|=_CSL_BOTTOM),t>n?a|=_CSL_RIGHT:t<e&&(a|=_CSL_LEFT),a},a=t.px1.x,r=t.px1.y,h=t.px2.x,l=t.px2.y,p=i.min.x,_=i.min.y,d=i.max.x,c=i.max.y,u=0,M=!1,f=!1;e=s(a,r,p,_,d,c),o=s(h,l,p,_,d,c);do{if(0==(e|o))M=!0,f=!0;else if((e&o)>0)f=!0;else{var m=0,g=0;n=0!=e?e:o,(n&_CSL_TOP)>0?(m=a+(h-a)*(c-r)/(l-r),g=c):(n&_CSL_BOTTOM)>0?(m=a+(h-a)*(_-r)/(l-r),g=_):(n&_CSL_RIGHT)>0?(g=r+(l-r)*(d-a)/(h-a),m=d):(n&_CSL_LEFT)>0&&(g=r+(l-r)*(p-a)/(h-a),m=p),n==e?(a=m,r=g,e=s(a,r,p,_,d,c)):(h=m,l=g,o=s(h,l,p,_,d,c))}u++}while(1!=f&&u<5e3);return M&&(t.px1.x=Math.floor(a),t.px1.y=Math.floor(r),t.px2.x=Math.floor(h),t.px2.y=Math.floor(l)),M},this.sutherlandHodgman=function(t,i){var e,o,n,s,a=[i.min,new MPixel(i.max.x,i.min.y),i.max,new MPixel(i.min.x,i.max.y)],r=function(t){return(o.x-e.x)*(t.y-e.y)>(o.y-e.y)*(t.x-e.x)},h=function(){var t=new MPixel(e.x-o.x,e.y-o.y),i=new MPixel(n.x-s.x,n.y-s.y),a=e.x*o.y-e.y*o.x,r=n.x*s.y-n.y*s.x,h=1/(t.x*i.y-t.y*i.x);return new MPixel(Math.round((a*i.x-r*t.x)*h),Math.round((a*i.y-r*t.y)*h))},l=t;e=a[a.length-1];for(var p in a){o=a[p];var _=l;l=[],n=_[_.length-1];for(var d in _)s=_[d],r(s)?(r(n)||l.push(h()),l.push(s)):r(n)&&l.push(h()),n=s;e=o}return l},this.removeNode=function(t){if(t instanceof Array)for(var i=0,e=t.length;i<e;i++)this.removeNode(t[i]);else{if(!MElement.isElement(t))return;t.parentNode?t.parentNode.removeChild(t):(_hiddenDom||_createHiddenDom(),_hiddenDom.appendChild(t),_hiddenDom.removeChild(t)),t=null}},this.timeout=function(t,i,e){var o=_argsToArray(arguments).slice(3);return"object"!=typeof t||"function"!=typeof i||"number"!=typeof e?null:setTimeout(function(){i.apply(t,o)},parseInt(e,10))},this.interval=function(t,i,e){var o=_argsToArray(arguments).slice(3);return"object"!=typeof t||"function"!=typeof i||"number"!=typeof e?null:setInterval(function(){i.apply(t,o)},parseInt(e))},this.continuous=function(t,i){if("function"==typeof t){var e=i?function(){t.apply(i);var e=arguments.callee;e.loop&&MTools.requestAnimationFrame.call(window,e)}:function(){t();var i=arguments.callee;i.loop&&MTools.requestAnimationFrame.call(window,i)};e.loop=!0;var o=MTools.requestAnimationFrame.call(window,e);return MTools.loops[o]=e,o}return null},this.clearContinuous=function(t){MTools.loops[t].loop=!1,delete MTools.loops[t]},this.arrayContains=function(t,i){for(var e=0,o=t.length;e<o;e++)if(t[e]===i)return e;return-1},this.extend=function(){var t,i=!1,e=!1;if("boolean"==typeof arguments[0]){if(null===arguments[1]&&"object"==typeof arguments[1])return null;i=!0,e=arguments[0]}else if("object"==typeof arguments[0]&&null===arguments[0])return null;t={};for(var o=i?1:0,n=arguments.length;o<n;o++){var s=arguments[o];for(var a in s){var r=s[a];null!=r&&"object"==typeof r&&e?(t[a]={},this.extend(e,t[a],r)):t[a]=r}}return t},this.measSize=function(t){_hiddenDom||_createHiddenDom(),_hiddenDom.innerHTML=t;var i=new MSize(_hiddenDom.clientWidth,_hiddenDom.clientHeight);return _hiddenDom.innerHTML="",i},this.camelize=function(t){return t.replace(new RegExp("-(\\w)","g"),function(t,i){return i.toUpperCase()})},this.uncamelize=function(t,i){return t.replace(new RegExp("(\\w)([A-Z])","g"),function(t,e,o){return e+(i?i:"-")+o.toLowerCase()})},this.ifUndefined=function(t,i){return"undefined"==typeof t?i:t},this.ifTypeOf=function(t,i,e){return typeof t===i?t:e},this.ifInstanceOf=function(t,i,e){return t instanceof i?t:e},this.decodeNumberEx=function(t){var i=0,e=[],o=t.length;if(o<=0)return e;for(;i<o;){var n=0,s=0,a=0,r=_EP_KEY;do{n=t.charCodeAt(i++)-63;var h=31&(n>>1^r++);a|=h<<s,s+=5}while(0==(1&n));a=1==(1&a)?~(a>>1):a>>1,e.push(a)}return e},this.isArray=function(t){return t instanceof Array},this.encode13=function(t,i){var e="",o=3409,n=parseInt(1e5*parseFloat(Math.max(-90,Math.min(90,i)))),s=parseInt(1e5*parseFloat(t<0?this.lng+360:t)),a=s-n+o,r=s+n;a<0&&(e="X",a=-a),r<0&&(e="Y",r=-r);for(var h=a.toString(16),l=r.toString(16),p=0;p<h.length;p++){var _=parseInt(h.charAt(p),16);e+=((_>=10?_+7:_)+10).toString(36)}e+="z";for(var d=0;d<l.length;d++){var c=parseInt(l.charAt(d),16);e+=((c>=10?c+7:c)+10).toString(36)}return e.toUpperCase()},this.decode13=function(t){var i=[0,0],e=-1,o=0,n="",s=3409,a="";null!=t&&parseInt(t.charAt(0),36)>=33&&(a=t.charAt(0),t=t.substring(1));for(var r=0;r<t.length-0;r++){var h=parseInt(t.charAt(r),36)-10;h>=17&&(h-=7),n+=h.toString(36),h>o&&(e=r,o=h)}var l=parseInt(n.substring(0,e),16),p=parseInt(n.substring(e+1),16);return"X"==a&&(l=-l),"Y"==a&&(p=-p),i[0]=(l+p-s)/2,i[1]=(p-i[0])/1e5,i[0]/=1e5,i[0]>180&&(i[0]-=360),new MPoint(i[0],i[1])},this.parseJSON=function(s){return JSON&&JSON.parse&&"function"==typeof JSON.parse?JSON.parse(s):eval("("+s+")")},this.getCss3Option=function(t,i){var e={};return e[t]=i,e["-webkit-"+t]=i,e["-moz-"+t]=i,e},this.getRequestObject=function(t){var i=!1,e=t.context;if(window.XMLHttpRequest?i=new window.XMLHttpRequest:window.ActiveXObject&&(i=new window.ActiveXObject("Microsoft.XMLHTTP")),!i)return!1;if(t=t||{},t.method=t.method||"GET",t.async=t.async||!0,!t.url)throw new Error("[url] parameter is not set");if("GET"===t.method&&t.data&&(t.url+="?"+_obj2url(t.data)),i.onreadystatechange=function(){switch(i.readyState){case 1:"function"==typeof t.loadListener&&t.loadListener.apply(e?e:i,arguments);break;case 2:"function"==typeof t.loadedListener&&t.loadedListener.apply(e?e:i,arguments);break;case 3:"function"==typeof t.inerativeListener&&t.ineractiveListener.apply(e?e:i,arguments);break;case 4:i.status&&200==i.status?"function"==typeof t.success&&t.success.call(e?e:i,i.responseText):"function"==typeof t.error&&t.error.apply(e?e:i,arguments)}},i.open(t.method,t.url,t.async,t.username,t.password),t.headers){var o,n=t.headers;for(var s in n)o=typeof n[s],!t.header.hasOwnProperty||"string"!=o&&"number"!=o||i.setRequestHeader(s.toString(),n[s].toString())}return i},this.ajaxRequest=function(t){t=t||{},t.method=t.method||"GET",t.async=t.async||!0;var i=this.getRequestObject(t);return i.send("POST"==t.method&&t.data?_obj2url(t.data):null),i},this.JSONP=function(t){var i,e=t.callbackname?t.callbackname:"jsonp"+_serialNumber(),o=t.context,n=function(){window[e]=void 0,t.error&&t.error.apply(o?o:window)};if(t=t||{},t.jsonp=t.jsonp||"callback",t.timeout=t.timeout||3e4,t.data=t.data||{},t.data[t.jsonp]=e,!t.url)throw new Error("[url] parameter is not set");var s,a=_obj2url(t.data);window[e]=function(){window.clearTimeout(i),window[e]=void 0,document.getElementsByTagName("head")[0].removeChild(s),t.success&&t.success.apply(o?o:window,arguments)},t.url+="?"+a,s=MElement.create("script",{type:"text/javascript",src:t.url}),document.getElementsByTagName("head")[0].appendChild(s),i=this.timeout(null,n,parseInt(t.timeout))},this.loadScript=function(t,i){if(!t)throw new Error("[url] parameter is not set");i=i||{},i.cache="boolean"!=typeof i.cache||i.cache,t+=i.cache?"":(t.indexOf("?")==-1?"?":"&")+"ran="+Math.random();var e=function(t){document.getElementsByTagName("head")[0].removeChild(t)},o=MElement.create("script",{type:"text/javascript",src:t});MEvent.bind(o,"readystatechange",function(){var t=i.success,o=i.complete,n=i.context;"loaded"!==this.readyState||this.getAttribute("error")||("function"==typeof t&&(n?t.apply(n):t()),"function"==typeof o&&(n?o.apply(n):o())),e(this)}),MEvent.bind(o,"load",function(){var t=i.success,o=i.complete,n=i.context;"function"==typeof t&&(n?t.apply(n):t()),"function"==typeof o&&(n?o.apply(n):o()),e(this)}),MEvent.bind(o,"error",function(){var t=i.error,o=i.complete,n=i.context;"function"==typeof t&&(n?t.apply(n):t()),this.readyState?this.setAttribute("error","true"):("function"==typeof o&&(n?o.apply(n):o()),e(this))}),document.getElementsByTagName("head")[0].appendChild(o)},this.colorHex=function(t){t=t.replace(new RegExp("\\s","g"),"").toLowerCase();var i=t.match(new RegExp("^(rgb|rgba)\\((\\d+)\\,(\\d+)\\,(\\d+)(\\,(\\d\\.?\\d?))?\\)$"));if(i){var e=parseInt(i[2]).toString(16),o=parseInt(i[3]).toString(16),n=parseInt(i[4]).toString(16);return e=1==e.length?"0"==e?e+e:"0"+e:e,o=1==o.length?"0"==o?o+o:"0"+o:o,n=1==n.length?"0"==n?n+n:"0"+n:n,"#"+e+o+n}return null},this.colorRgb=function(t,i){t=t.replace(new RegExp("\\s","g"),"").toLowerCase();var e=t.match(new RegExp("^(#)?([0-9a-z]{6}|[0-9a-z]{3})$")),o=new RegExp("^([\\d\\w]{1,2})([\\d\\w]{1,2})([\\d\\w]{1,2})$");if(e){var n=e[2].match(o),s=parseInt("0x"+(1==n[1].length?n[1]+n[1]:n[1])),a=parseInt("0x"+(1==n[2].length?n[2]+n[2]:n[2])),r=parseInt("0x"+(1==n[3].length?n[3]+n[3]:n[3])),h=[];return h.push(i?"rgba("+s:"rgb("+s),h.push(a),h.push(i?r:r+")"),h.push(i?i+")":""),h.join(",")}return new RegExp("^(rgb|rgba)\\((\\d+)\\,(\\d+)\\,(\\d+)(\\,(\\d\\.?\\d?))?\\)$").test(t)?t:null},this.importStylesheet=function(t,i){i="number"!=typeof i?0:i;var e=0==i,o=e?MElement.create$("style"):MElement.create$("link");o.setAttr({type:"text/css"}),e?o.html(t):o.setAttr({ref:"stylesheet",href:t}),document.getElementsByTagName("head")[0].appendChild(o.get(0))},this.supportCanvas=function(){return"undefined"==typeof _supportCanvas&&(_supportCanvas=!!document.createElement("canvas").getContext),_supportCanvas},this.clearCanvas=function(t,i,e){if(t){var o=MClass.classOf(i,MPixel)?i:new MPixel(0,0),n=MClass.classOf(e,MSize)?e:new MSize(t.canvas.width,t.canvas.height);t.clearRect(o.x,o.y,n.width,n.height)}},this.paintLine=function(t,i,e,o){e=e||{};var n=i.length;if(n>1){t.save(),_setContextOptions(t,e),t.beginPath(),t.moveTo(i[0].x,i[0].y);for(var s=1;s<n;s++){var a=i[s];t.lineTo(a.x,a.y)}o&&t.closePath(),t.stroke(),o&&t.fill(),t.restore()}},this.paintLines=function(t,i,e){e=e||{};var o=i.length;if(o>0){t.save(),_setContextOptions(t,e),t.beginPath();for(var n=0;n<o;n++){var s=i[n],a=s.length;t.moveTo(s[0].x,s[0].y);for(var r=1;r<a;r++){var h=s[r];t.lineTo(h.x,h.y)}}t.stroke(),t.restore()}},this.paintCircle=function(t,i,e,o,n,s){s=s||{},t.save(),_setContextOptions(t,s),t.beginPath(),t.arc(i.x,i.y,e,0,Math.PI/180*360,!0),n&&t.stroke(),o&&t.fill(),t.restore()},this.paintImage=function(t,i,e,o,n,s){e=MClass.classOf(e,MPixel)?e:new MPixel(0,0);var a=MClass.classOf(o,MSize),r=MClass.classOf(n,MPixel),h=MClass.classOf(s,MSize);t&&i&&(a&&r&&h?t.drawImage(i,n.x,n.y,s.width,s.height,e.x,e.y,o.width,o.height):a?t.drawImage(i,e.x,e.y,o.width,o.height):t.drawImage(i,e.x,e.y))},this.getViewportScale=function(){return MTools.browser.ipad||MTools.browser.iphone?this.getViewportScale=function(){return 90===Math.abs(window.orientation)?window.innerWidth/Math.max(screen.width,screen.height):window.innerWidth/Math.min(screen.width,screen.height)}:this.getViewportScale=function(){return 1},this.getViewportScale()},this.tween={Linear:function(t,i,e,o){return e*t/o+i},Quad:{easeIn:function(t,i,e,o){return e*(t/=o)*t+i},easeOut:function(t,i,e,o){return-e*(t/=o)*(t-2)+i},easeInOut:function(t,i,e,o){return(t/=o/2)<1?e/2*t*t+i:-e/2*(--t*(t-2)-1)+i}},Cubic:{easeIn:function(t,i,e,o){return e*(t/=o)*t*t+i},easeOut:function(t,i,e,o){return e*((t=t/o-1)*t*t+1)+i},easeInOut:function(t,i,e,o){return(t/=o/2)<1?e/2*t*t*t+i:e/2*((t-=2)*t*t+2)+i}},Quart:{easeIn:function(t,i,e,o){return e*(t/=o)*t*t*t+i},easeOut:function(t,i,e,o){return-e*((t=t/o-1)*t*t*t-1)+i},easeInOut:function(t,i,e,o){return(t/=o/2)<1?e/2*t*t*t*t+i:-e/2*((t-=2)*t*t*t-2)+i}},Quint:{easeIn:function(t,i,e,o){return e*(t/=o)*t*t*t*t+i},easeOut:function(t,i,e,o){return e*((t=t/o-1)*t*t*t*t+1)+i},easeInOut:function(t,i,e,o){return(t/=o/2)<1?e/2*t*t*t*t*t+i:e/2*((t-=2)*t*t*t*t+2)+i}},Sine:{easeIn:function(t,i,e,o){return-e*Math.cos(t/o*(Math.PI/2))+e+i},easeOut:function(t,i,e,o){return e*Math.sin(t/o*(Math.PI/2))+i},easeInOut:function(t,i,e,o){return-e/2*(Math.cos(Math.PI*t/o)-1)+i}},Expo:{easeIn:function(t,i,e,o){return 0==t?i:e*Math.pow(2,10*(t/o-1))+i},easeOut:function(t,i,e,o){return t==o?i+e:e*(-Math.pow(2,-10*t/o)+1)+i},easeInOut:function(t,i,e,o){return 0==t?i:t==o?i+e:(t/=o/2)<1?e/2*Math.pow(2,10*(t-1))+i:e/2*(-Math.pow(2,-10*--t)+2)+i}},Circ:{easeIn:function(t,i,e,o){return-e*(Math.sqrt(1-(t/=o)*t)-1)+i},easeOut:function(t,i,e,o){return e*Math.sqrt(1-(t=t/o-1)*t)+i},easeInOut:function(t,i,e,o){return(t/=o/2)<1?-e/2*(Math.sqrt(1-t*t)-1)+i:e/2*(Math.sqrt(1-(t-=2)*t)+1)+i}},Elastic:{easeIn:function(t,i,e,o,n,s){if(0==t)return i;if(1==(t/=o))return i+e;if(s||(s=.3*o),!n||n<Math.abs(e)){n=e;var a=s/4}else var a=s/(2*Math.PI)*Math.asin(e/n);return-(n*Math.pow(2,10*(t-=1))*Math.sin((t*o-a)*(2*Math.PI)/s))+i},easeOut:function(t,i,e,o,n,s){if(0==t)return i;if(1==(t/=o))return i+e;if(s||(s=.3*o),!n||n<Math.abs(e)){n=e;var a=s/4}else var a=s/(2*Math.PI)*Math.asin(e/n);return n*Math.pow(2,-10*t)*Math.sin((t*o-a)*(2*Math.PI)/s)+e+i},easeInOut:function(t,i,e,o,n,s){if(0==t)return i;if(2==(t/=o/2))return i+e;if(s||(s=o*(.3*1.5)),!n||n<Math.abs(e)){n=e;var a=s/4}else var a=s/(2*Math.PI)*Math.asin(e/n);return t<1?-.5*(n*Math.pow(2,10*(t-=1))*Math.sin((t*o-a)*(2*Math.PI)/s))+i:n*Math.pow(2,-10*(t-=1))*Math.sin((t*o-a)*(2*Math.PI)/s)*.5+e+i}},Back:{easeIn:function(t,i,e,o,n){return void 0==n&&(n=1.70158),e*(t/=o)*t*((n+1)*t-n)+i},easeOut:function(t,i,e,o,n){return void 0==n&&(n=1.70158),e*((t=t/o-1)*t*((n+1)*t+n)+1)+i},easeInOut:function(t,i,e,o,n){return void 0==n&&(n=1.70158),(t/=o/2)<1?e/2*(t*t*(((n*=1.525)+1)*t-n))+i:e/2*((t-=2)*t*(((n*=1.525)+1)*t+n)+2)+i}},Bounce:{easeIn:function(t,i,e,o){return e-Tween.Bounce.easeOut(o-t,0,e,o)+i},easeOut:function(t,i,e,o){return(t/=o)<1/2.75?e*(7.5625*t*t)+i:t<2/2.75?e*(7.5625*(t-=1.5/2.75)*t+.75)+i:t<2.5/2.75?e*(7.5625*(t-=2.25/2.75)*t+.9375)+i:e*(7.5625*(t-=2.625/2.75)*t+.984375)+i},easeInOut:function(t,i,e,o){return t<o/2?.5*Tween.Bounce.easeIn(2*t,0,e,o)+i:.5*Tween.Bounce.easeOut(2*t-o,0,e,o)+.5*e+i}}}},MClass=new function(){var t={},i=function(i){return i instanceof Function&&e(t[this.className],i)},e=function(t,i){if(t&&i){if(i===t.prototype.superClass)return!0;var o=t.prototype;return!(!o||!o.superClass)&&e(o.superClass,i)}return!1};this.classOf=function(t,i,e){return t&&t instanceof i?3!==arguments.length||t:3===arguments.length&&e},this.create=function(e,o){var n=function(){n.initialize instanceof Function&&n.initialize.apply(this,arguments)};if(t[e]&&delete t[e],t[e]=n,o instanceof Function){var s=function(){};s.prototype=o.prototype,n.prototype=new s}return n.prototype.constructor=n,n.prototype.superClass=o,n.prototype.className=e,n.prototype.superClassOf=i,n},this.finalize=function(t){t.hasOwnProperty("__proto__")&&(t.__proto__=null);for(var i in t)t[i]=null},this.chkObj=function(t,i){return t&&t instanceof i?t:null}},MObject=MClass.create("MObject");MObject.prototype.getType=function(){return this.constructor},MObject.prototype.getTypeString=function(){return this.className},MObject.prototype.clone=function(){return null},MObject.prototype.equals=function(t){return this==t},MObject.prototype.toString=function(){return this.className},MObject.prototype.finalize=function(){for(var t in this)this[t]=null,delete this[t];MClass.finalize(this)};var MPixel=MClass.create("MPixel",MObject);MPixel.initialize=function(t,i){this.x="number"==typeof t?t:0,this.y="number"==typeof i?i:0},MPixel.prototype.clone=function(){return new MPixel(this.x,this.y)},MPixel.prototype.equals=function(t){return t instanceof MPixel&&this.x==t.x&&this.y==t.y},MPixel.prototype.toString=function(){return this.className+": {"+this.x+", "+this.y+"}"};var MSize=MClass.create("MSize",MObject);MSize.initialize=function(t,i){t="number"!=typeof t?0:t,i="number"!=typeof i?0:i,this.width=t,this.height=i},MSize.prototype.clone=function(){return new MSize(this.width,this.height)},MSize.prototype.equals=function(t){return t instanceof MSize&&this.width==t.width&&this.height==t.height},MSize.prototype.toString=function(){return this.className+": {"+this.width+", "+this.height+"}"};var MBounds=MClass.create("MBounds",MObject);MBounds.initialize=function(t,i){this.min=t&&t instanceof MPoint?t:null,this.max=i&&i instanceof MPoint?i:null},MBounds.prototype.mid=function(){return this.min&&this.max?new MPoint((this.min.lng+this.max.lng)/2,(this.min.lat+this.max.lat)/2):null},MBounds.prototype.contains=function(t){return!!(this.min&&this.max&&t instanceof MPoint)&&t.lng>=this.min.lng&&t.lat>=this.min.lat&&t.lng<=this.max.lng&&t.lat<=this.max.lat},MBounds.prototype.containsRange=function(t){return t instanceof MBounds&&this.contains(t.min)&&this.contains(t.max)},MBounds.prototype.intersects=function(t){if(t&&t instanceof MBounds){var i=new MPoint(Math.max(this.min.lng,t.min.lng),Math.max(this.min.lat,t.min.lat)),e=new MPoint(Math.min(this.max.lng,t.max.lng),Math.min(this.max.lat,t.max.lat));return i.lng<=e.lng&&i.lat<=e.lat?new MBounds(i,e):null}return null},MBounds.prototype.isIntersect=function(t){if(t instanceof MBounds){var i=new MPoint(Math.max(this.min.lng,t.min.lng),Math.max(this.min.lat,t.min.lat)),e=new MPoint(Math.min(this.max.lng,t.max.lng),Math.min(this.max.lat,t.max.lat));return i.lng<=e.lng&&i.lat<=e.lat}return!1},MBounds.prototype["extends"]=function(t){if(t instanceof MPoint)this.contains(t)||(this.max.lng=Math.max(t.lng,this.max.lng),this.max.lat=Math.max(t.lat,this.max.lat),this.min.lng=Math.min(t.lng,this.min.lng),this.min.lat=Math.min(t.lat,this.min.lat));else if(t instanceof Array)for(var i=0,e=t.length;i<e;i++)this["extends"](t[i])},MBounds.prototype.clone=function(){return new MBounds(this.min,this.max)},MBounds.prototype.equals=function(t){return t instanceof MBounds&&this.max.equals(t.max)&&this.min.equals(t.min)},MBounds.prototype.toString=function(){return this.className+": {"+this.min.toString()+", "+this.max.toString()+"}"};var MAnime=MClass.create("MAnime",MObject);MAnime.initialize=function(t){this._initOptions(t),this._status=void 0,this._current=void 0,this._timer=void 0},MAnime.prototype.start=function(){return this.stop(),this._current=1/this._fps,this._status=1,this._timer=MTools.interval(this,MAnime.AnimationExec(this),1e3/this._fps),this},MAnime.prototype.stop=function(){return this._timer&&window.clearInterval(this._timer),this._timer=null,this._status=0,this._current=-1,1==arguments[0]&&MEvent.trigger(this,"stoped"),this},MAnime.prototype.runing=function(){return!!this._status},MAnime.prototype.getStatus=function(){return this._status},MAnime.prototype.setBegins=function(t){return this._begins=t,this},MAnime.prototype.setEnds=function(t){return this._ends=t,this},MAnime.prototype.getCurrent=function(){return this._current},MAnime.prototype.setCurrent=function(t){return this._current=t,this},MAnime.prototype.getDuration=function(){return this._duration},MAnime.prototype.setDuration=function(t){return this._duration=t,this},MAnime.prototype.getFps=function(){return this._fps},MAnime.prototype.setFps=function(t){return this._fps=t,this},MAnime.prototype.frame=function(t){var i=this._begins,e=this._ends,o=this._method,n=this._duration,s=this._fps,a={},r={};for(var h in i)if(i.hasOwnProperty(h)&&e.hasOwnProperty(h)){var l,p,_=e[h]-i[h];if(0!=n){l=o(t,i[h],_,n);var d=t-1/s;d<0&&(d=0),p=l-o(d,i[h],_,n)}else l=e[h],p=_;a[h]=parseFloat(l,10),r[h]=parseFloat(p,10)}this._qFxFrame(a,r)},MAnime.AnimationExec=function(t){return function(){var i=t.getCurrent(),e=t.getDuration(),o=t.getFps();return i>e&&(i=e),t.frame(i),i>=e?void t.stop(!0):void t.setCurrent(i+1/o)}},MAnime.prototype._initOptions=function(t){t=t||{},this._begins=MTools.ifUndefined(t.begins,{}),this._ends=MTools.ifUndefined(t.ends,{}),this._method=MTools.ifUndefined(t.method,MAnime._easeOutCubic),this._duration=MTools.ifUndefined(t.duration,0),this._fps=MTools.ifUndefined(t.fps,40)},MAnime.prototype._qFxFrame=function(t,i){MEvent.trigger(this,"changed",t,i)},MAnime._easeOutCubic=function(t,i,e,o){return e*(Math.pow(t/o-1,3)+1)+i};var MElement=function(t){if(this._elements=[],!t)return this;if(t.nodeType)return this._elements.push(t),this;if("body"===t&&document.body)return this._elements.push(document.body),this;if("string"==typeof t){var i=new RegExp(/^<(\\w+)\\s*\/?>(?:<\/\1>)?$/).exec(t);if(i)this._elements.push(document.createElement(i[1]));else{i=t.split(new RegExp("\\s*,\\s*"));for(var e=0,o=i.length;e<o;e++)this._elements.push(document.getElementById(i[e]))}return this}if(t instanceof Array){for(var e=0,o=t.length;e<o;e++){var n=t[e];if(n.nodeType)this._elements.push(n);else if(n instanceof MElement){var s=n.get();this._elements=this._elements.concat(s)}else"string"==typeof n&&this._elements.push(document.getElementById(n))}return this}};MElement.prototype={className:"MElement",toString:function(){return this.className},each:function(t){for(var i=0,e=this._elements.length;i<e&&t.call(this._elements[i],i)!==!1;i++);return this},length:function(){return this._elements.length},eq:function(t){return new MElement(this._elements[t])},get:function(t){return"number"==typeof t?this._elements[t]:this._elements.concat()},setAttr:function(t,i){var e=arguments[0],o=arguments[1];if("string"==typeof e)"string"==typeof o?this.each(function(){this.setAttribute(e,o)}):"function"==typeof o&&this.each(function(){this.setAttribute(e,o.apply(this))});else if("object"==typeof e)for(var n in e)this.each(function(){this.setAttribute(n,e[n])});return this},attr:function(t){return this._elements[0].getAttribute(t)},removeAttr:function(t){return this.each(function(){this.removeAttribute(t)}),this},html:function(t){return"string"!=typeof t?this._elements[0].innerHTML:(this.each(function(){this.innerHTML=t}),this)},setCss:function(t,i){if("string"==typeof t&&"string"==typeof i)this.each(function(){this.style.setProperty?this.style.setProperty(MTools.uncamelize(t),i,null):this.style[MTools.uncamelize(t)]=i});else if("object"==typeof t)for(var e in t)this.each(function(){this.style.setProperty?this.style.setProperty(MTools.uncamelize(e.toString()),t[e].toString(),null):this.style[MTools.uncamelize(e.toString())]=t[e].toString()});return this},setCss3:function(t,i){if("string"==typeof t&&"string"==typeof i)this.setCss(MTools.getCss3Option(t,i));else if("object"==typeof t)for(var e in t)this.setCss3(e,t[e]);return this},css:function(t){var i,e=this._elements[0];return e&&(document.defaultView?i=document.defaultView.getComputedStyle(e,null).getPropertyValue(t):(i=e.currentStyle[t],i="medium"==i?"0px":"undefined"==typeof i?"0px":i)),i},addClass:function(t){return this.each(function(){MElement.addClass(this,t)}),this},removeClass:function(t){return this.each(function(){MElement.removeClass(this,t)}),this},children:function(){var t=[];return this.each(function(){for(var i=this.children,e=0,o=i.length;e<o;e++)t.push(i[e])}),new MElement(t)},parent:function(){var t=[];return this.each(function(i){var e=!1;if(i>0)for(var o=0,n=t.length;o<n;o++)if(t[o]==this.parentNode){e=!0;break}!e&&t.push(this.parentNode)}),new MElement(t)},remove:function(){return this.each(function(){MTools.removeNode(this)}),this},empty:function(){return this.each(function(){for(var t=this.children;t.length>0;)MTools.removeNode(t[0])}),this},clone:function(t){var i=[];return this.each(function(){i.push(this.cloneNode(t))}),new MElement(i)},append:function(t){var i="string"==typeof t?0:MElement.isElement(t)?1:t instanceof MElement?2:-1;return this.each(function(e){if(0==i)this.html(t);else{if(1==i)return this.appendChild(t),!1;if(2==i){for(var o=0,n=t.length();o<n;o++)this.appendChild(t.get(o));return!1}}}),this},appendTo:function(t){return(MElement.isElement(t)||"string"==typeof t)&&(t=new MElement([t])),t.append(this),this},show:function(){return this.setCss("display","block"),this},hide:function(){return this.setCss("display","none"),this},offset:function(){for(var t,i=this.eq(0),e=i.position(),o=i.parent();!MElement.isDocument(o.get(0));)t=o.position(),e.x+=t.x,e.y+=t.y,o=o.parent();return e},position:function(){var t=this._elements[0];return t?new MPixel(t.offsetLeft,t.offsetTop):null},innerSize:function(t){var i=this.eq(0),e=this._elements[0];t="undefined"==typeof t||t;var o,n;if(MElement.isElement(e))return o=e.offsetWidth-Math.round(parseFloat(i.css("border-left-width")))-Math.round(parseFloat(i.css("border-right-width"))),n=e.offsetHeight-Math.round(parseFloat(i.css("border-top-width")))-Math.round(parseFloat(i.css("border-bottom-width"))),t||(o-=Math.round(parseFloat(i.css("padding-left")))+Math.round(parseFloat(i.css("padding-right"))),n-=Math.round(parseFloat(i.css("padding-top")))+Math.round(parseFloat(i.css("padding-bottom")))),new MSize(o,n)},outerSize:function(t){var i=this.eq(0),e=this._elements[0];if(t="undefined"!=typeof t&&t,MElement.isElement(e)){var o=e.offsetWidth,n=e.offsetHeight;return t&&(o+=Math.round(parseFloat(i.css("margin-left")))+Math.round(parseFloat(i.css("margin-right"))),n+=Math.round(parseFloat(i.css("margin-top")))+Math.round(parseFloat(i.css("margin-bottom")))),new MSize(o,n)}return new MSize(0,0)},bind:function(t,i,e,o){return this.each(function(){MEvent.bind(this,t,i,e,o)}),this},unbind:function(t,i,e){return this.each(function(){MEvent.unbind(this,t,i,e)}),this},click:function(t,i,e){return this.bind("click",t,i,e)},dblclick:function(t,i,e){return this.bind("dblclick",t,i,e);
},mousedown:function(t,i,e){return this.bind("mousedown",t,i,e)},mouseup:function(t,i,e){return this.bind("mouseup",t,i,e)},mousemove:function(t,i,e){return this.bind("mousemove",t,i,e)},mouseover:function(t,i,e){return this.bind("mouseover",t,i,e)},mouseout:function(t,i,e){return this.bind("mouseout",t,i,e)},touchstart:function(t,i,e){return this.bind("touchstart",t,i,e)},touchmove:function(t,i,e){return this.bind("touchmove",t,i,e)},touchend:function(t,i,e){return this.bind("touchend",t,i,e)},mousewheel:function(t,i,e){return this.each(function(){MEvent.mouseWheel(this,t,i,e)}),this}},MElement.$$=function(t){return new MElement(t)},MElement.$=function(t){for(var i=[],e=0,o=arguments.length;e<o;e++){var n=arguments[e];if("string"==typeof n&&(n=document.getElementById(n)),1==o)return n;i.push(n)}return i},MElement.create$=function(t){var i;try{i=document.createElement(t)}catch(t){throw new Error(t.message)}return this.$$(i)},MElement.createSVG$=function(t){return this.$$(this.createSVG(t))},MElement.create=function(t,i,e){try{var o=document.createElement(t);return this.setAttr(o,i),MElement.isElement(e)&&e.appendChild(o),o}catch(t){throw new Error(t.message)}},MElement.createSVG=function(t,i,e){var o=document.createElementNS("http://www.w3.org/2000/svg",t);return this.setAttr(o,i),MElement.isElement(e)&&e.appendChild(o),o},MElement.setAttr=function(t,i){if(t instanceof Array){for(var e=[],o=0,n=t.length;o<n;o++){var s=this.setAttr(t[o],i);s&&e.push(s)}return e}if(!(t=this.$(t)))return null;for(var a in i)i.hasOwnProperty(a)&&t.setAttribute(a,i[a]);return t},MElement.setStyle=function(t,i){MElement.$$(t).setCss(i)},MElement.isElement=function(t,i){return"object"==typeof t&&null!=t&&(t==window||t==document||1==t.nodeType&&(!i||t.tagName==i.toUpperCase()))},MElement.hasClass=function(t,i){return!(!MElement.isElement(t)||"string"!=typeof i)&&new RegExp("(\\s+|^)"+i+"(\\s+|$)").test(t.className)},MElement.addClass=function(t,i){MElement.isElement(t)&&"string"==typeof i&&(MElement.hasClass(t,i)||(t.className+=" "+i))},MElement.removeClass=function(t,i){MElement.isElement(t)&&("string"==typeof i?t.className=t.className.replace(new RegExp("(\\s+|^)"+i+"(\\s+|$)"),""):t.className="")},MElement.isDocument=function(t){return"object"==typeof t&&null!=t&&t==document};var MPixelBounds=MClass.create("MPixelBounds",MObject);MPixelBounds.initialize=function(t,i){this.min=MClass.classOf(t,MPixel,null),this.max=MClass.classOf(i,MPixel,null),this._size=null},MPixelBounds.prototype.mid=function(){return new MPixel(Math.round(this.min.x+(this.max.x-this.min.x)/2),Math.round(this.min.y+(this.max.y-this.min.y)/2))},MPixelBounds.prototype.contains=function(t){return!!MClass.classOf(t,MPixel)&&t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y},MPixelBounds.prototype.intersects=function(t){if(MClass.classOf(t,MPixelBounds)){var i=this.min.x>t.min.x?this.min.x:t.min.x,e=this.min.y>t.min.y?this.min.y:t.min.y,o=this.max.x<t.max.x?this.max.x:t.max.x,n=this.max.y<t.max.y?this.max.y:t.max.y;return i<=o&&e<=n?new MPixelBounds(new MPixel(i,e),new MPixel(o,n)):null}return null},MPixelBounds.prototype.size=function(){return this._size instanceof MSize||(this._size=new MSize(Math.round(this.max.x-this.min.x),Math.round(this.max.y-this.min.y))),this._size},MPixelBounds.prototype["extends"]=function(t){if(t instanceof MPixel)this.contains(t)||(this.max.x=Math.max(t.x,this.max.x),this.max.y=Math.max(t.y,this.max.y),this.min.x=Math.min(t.x,this.min.x),this.min.y=Math.min(t.y,this.min.y),this._size=null);else if(t instanceof Array)for(var i=0,e=t.length;i<e;i++)this["extends"](t[i])},MPixelBounds.prototype.clone=function(){return new MPixelBounds(this.min,this.max)},MPixelBounds.prototype.equals=function(t){return MClass.classOf(t,MPixelBounds)&&this.min.equals(t.min)&&this.max.equals(t.max)},MPixelBounds.prototype.toString=function(){return this.className+": {"+this.min.toString()+", "+this.max.toString()+"}"};var MMapMode={PAN:1,MARKER:2},MPointType={CODE13:1,CODE14:2,M09:3,WGS84:4,GCJ02:5},MTilePathType={RELATIVE:1,ABSOLUTE:2},MPositionType={LEFT_TOP:0,LEFT_BOTTOM:1,RIGHT_TOP:2,RIGHT_BOTTOM:3,CENTER_BOTTOM:4},MSysLayerZIndex={MAP_CONTAINER:2,MAP_BACKGROUND:0,MAP_LAYER:1,TRAFFIC_LAYER:2,LAYERS_CONTAINER:3,SVG_CONTAINER:4,SHADOW_CONTAINER:5,MARKER_CONTAINER:6,HANDLE_CONTAINER:7,IW_CONTAINER:8,PANEL_CONTAINER:10},MGridEventAction={NORMAL:0,DRAGGING:1},MStrokeStyle={SOLID:0,DASHED:1,SHORTDASHED:2,LONGDASHED:3,DOTTED:4,SHORTDOTTED:5,DOTDASHED:6,SHORTDOTDASHED:7,LONGDOTDASHED:8},MIcon=MClass.create("MIcon",MObject);MIcon.initialize=function(t){t=MTools.ifUndefined(t,{}),this._overlay=null,this._anchor=MClass.classOf(t.anchor,MPixel,null),this._isDefaultAnchor=!this._anchor,this._size=MClass.classOf(t.size,MSize,null),this._dom=null,this._$dom=null,this._map=null,this._location=null,this._isShadow=!1,this._zIndex=void 0},MIcon.prototype._initOptions=function(){this._dom||(this._$dom=MElement.create$("span").setCss({position:"absolute",overflow:"hidden"}),this._dom=this._$dom.get(0)),this._size||(this._size=new MSize(32,32)),this.setSize(this._size),this._anchor||(this._anchor=new MPixel(this._size.width/2,this._size.height))},MIcon.prototype._setLocation=function(t){this._location=t;var i=this._map.size(),e=i.width,o=i.height,n=new MPixelBounds(new MPixel((-e),(-o)),new MPixel(2*e,2*o));this._dom&&(n.contains(t)?this._$dom.setCss({left:t.x-this._anchor.x+"px",top:t.y-this._anchor.y+"px"}).show():this._$dom.hide())},MIcon.prototype.setMap=function(t){this._map=t,this._initOptions()},MIcon.prototype.map=function(){return this._map},MIcon.prototype.paint=function(t){this._overlay&&this._map&&(this._dom.parentNode||(this._isShadow?this._$dom.appendTo(this._map._shadowContainer):this._$dom.appendTo(this._map._markerContainer)),t=t||this._map.toPixel(this._overlay.point()),this._setLocation(t))},MIcon.prototype.overlay=function(){return this._overlay},MIcon.prototype.setOverlay=function(t){t instanceof MOverlay&&(this._overlay=t)},MIcon.prototype.anchor=function(){return this._anchor},MIcon.prototype.setAnchor=function(t){this._anchor=MClass.classOf(t,MPixel,this._anchor),this._isDefaultAnchor=!1,this.visible()&&this._location&&this._setLocation(this._location)},MIcon.prototype.size=function(){return this._size},MIcon.prototype.setSize=function(t){t instanceof MSize&&(this._size=t,this._dom&&this._$dom.setCss({width:this._size.width+"px",height:this._size.height+"px"}))},MIcon.prototype.visible=function(){return this._$dom&&"none"!=this._$dom.css("display")},MIcon.prototype.show=function(){this._dom&&this._$dom.show()},MIcon.prototype.hide=function(){this._dom&&this._$dom.hide()},MIcon.prototype.isShadow=function(){return this._isShadow},MIcon.prototype.toShadow=function(){this._isShadow=!0},MIcon.prototype.zIndex=function(){return this._zIndex},MIcon.prototype.setZIndex=function(t){"number"==typeof t&&(this._zIndex=t,this._$dom.setCss({zIndex:t}))},MIcon.prototype.remove=function(){this._map=null,this._overlay=null,this._$dom.remove()},MIcon.prototype.finalize=function(){this.remove(),MObject.prototype.finalize.apply(this)};var MImgIcon=MClass.create("MImgIcon",MIcon);MImgIcon.initialize=function(t,i){MIcon.initialize.call(this,i),this._url=MTools.ifUndefined(t,""),this._offset=MTools.ifUndefined(i.offset,null),this._touchPixel=void 0},MImgIcon.prototype._initOptions=function(){MIcon.prototype._initOptions.apply(this),""===this._url&&(this._url=this._map.defaultImgIconUrl()),this._offset||(this._offset=new MPixel(0,0)),this._$dom.setCss({backgroundImage:"url("+this._url+")"}),this.setSize(this._size),this.setOffset(this._offset),this._$dom.click(this._onclick,this),this._$dom.mouseover(this._onmouseover,this),this._$dom.mouseout(this._onmouseout,this),this._$dom.touchstart(this._ontouchstart,this),this._$dom.touchend(this._ontouchend,this)},MImgIcon.prototype._ontouchstart=function(t){t.preventDefault(),t.stopPropagation();var i=t.e.touches[0];this._touchPixel=new MPixel(i.pageX,i.pageY)},MImgIcon.prototype._ontouchend=function(t){t.preventDefault(),t.stopPropagation();var i=t.e.changedTouches[0];Math.abs(i.pageX-this._touchPixel.x)<=10&&Math.abs(i.pageY-this._touchPixel.y)<=10&&this._triggerClickEvent()},MImgIcon.prototype._onclick=function(t){t.preventDefault(),t.stopPropagation(),this._triggerClickEvent()},MImgIcon.prototype._triggerClickEvent=function(){MEvent.trigger(this,"click")},MImgIcon.prototype._onmouseover=function(t){t.preventDefault(),t.stopPropagation(),MEvent.trigger(this,"mouseover")},MImgIcon.prototype._onmouseout=function(t){t.preventDefault(),t.stopPropagation(),MEvent.trigger(this,"mouseout")},MImgIcon.prototype.offset=function(){return this._offset},MImgIcon.prototype.setOffset=function(t){t instanceof MPixel&&(this._offset=t,this._$dom.setCss({backgroundPosition:[t.x,"px"," ",t.y,"px"].join("")}))},MImgIcon.prototype.finalize=function(){MEvent.clear(this),MIcon.prototype.finalize.apply(this)},MImgIcon.prototype.url=function(){return this._url},MImgIcon.prototype.setUrl=function(t){this._url=t,this._$dom.setCss({backgroundImage:"url("+t+")"})};var MRichIcon=MClass.create("MRichIcon",MIcon);MRichIcon.initialize=function(t,i){MIcon.initialize.call(this,i),this._content=t},MRichIcon.prototype.getContent=function(){return this._content},MRichIcon.prototype.setContent=function(t){"string"!=typeof t&&!MElement.isElement(t)||this._content===t||(this._content=t)},MRichIcon.prototype.finalize=function(){MEvent.clear(this),MIcon.prototype.finalize.apply(this)},MRichIcon.prototype._initOptions=function(){MIcon.prototype._initOptions.apply(this),"string"==typeof this._content?this._$dom.html(this._content):MElement.isElement(this._content)&&this._$dom.append(this._content),this.setSize(this._size),this._$dom.click(this._onclick,this),this._$dom.mouseover(this._onmouseover,this),this._$dom.mouseout(this._onmouseout,this),this._$dom.touchstart(this._ontouchstart,this),this._$dom.touchend(this._ontouchend,this)},MRichIcon.prototype._ontouchstart=function(t){t.preventDefault(),t.stopPropagation();var i=t.e.touches[0];this._touchPixel=new MPixel(i.pageX,i.pageY)},MRichIcon.prototype._ontouchend=function(t){t.preventDefault(),t.stopPropagation();var i=t.e.changedTouches[0];Math.abs(i.pageX-this._touchPixel.x)<=10&&Math.abs(i.pageY-this._touchPixel.y)<=10&&this._triggerClickEvent()},MRichIcon.prototype._onclick=function(t){t.preventDefault(),t.stopPropagation(),this._triggerClickEvent()},MRichIcon.prototype._triggerClickEvent=function(){MEvent.trigger(this,"click")},MRichIcon.prototype._onmouseover=function(t){t.preventDefault(),t.stopPropagation(),MEvent.trigger(this,"mouseover")},MRichIcon.prototype._onmouseout=function(t){t.preventDefault(),t.stopPropagation(),MEvent.trigger(this,"mouseout")};var MOverlay=MClass.create("MOverlay",MObject);MOverlay.initialize=function(t){this._id=MOverlay.createID(),this._map=null,this._bounds=null,this._initOptions(t)},MOverlay._seqnum=0,MOverlay.createID=function(){return MOverlay._seqnum++},MOverlay.prototype.id=function(){return this._id},MOverlay.prototype.map=function(){return this._map},MOverlay.prototype.setMap=function(t){t instanceof MMap&&(this._map=t)},MOverlay.prototype.bounds=function(){},MOverlay.prototype.paint=function(){},MOverlay.prototype.show=function(){},MOverlay.prototype.hide=function(){},MOverlay.prototype.visible=function(){},MOverlay.prototype.setTop=function(){},MOverlay.prototype.allowedClear=function(){return this._allowedClear},MOverlay.prototype.setAllowedClear=function(t){this._allowedClear="boolean"!=typeof t||t},MOverlay.prototype.remove=function(){this._map.removeOverlay(this,!1,!0),this._map=void 0},MOverlay.prototype.finalize=function(){MObject.prototype.finalize.apply(this,arguments)},MOverlay.prototype.setInfoWindow=function(t){t instanceof MInfoWindowView&&this._infowindow!==t&&(this._infowindow instanceof MInfoWindowView&&this._infowindow.opening()&&(this._infowindow.setOwner(null),this._map&&this._map.closeInfoWindow(this._infowindow)),this._infowindow=t,t.setOwner(this))},MOverlay.prototype.openInfoWindow=function(t){t instanceof MInfoWindowView&&this.setInfoWindow(t),this._infowindow.setMap(this._map)},MOverlay.prototype.closeInfoWindow=function(){this._infowindow instanceof MInfoWindowView&&this._infowindow.close()},MOverlay.prototype._clearBounds=function(){this._bounds=null},MOverlay.prototype._initOptions=function(t){this._allowedClear=MTools.ifTypeOf(t.allowedClear,"boolean",!0),this._infowindow=MTools.ifInstanceOf(t.infowindow,MInfoWindowView,void 0)};var MMarker=MClass.create("MMarker",MOverlay);MMarker.initialize=function(t,i){i=i||{},MOverlay.initialize.call(this,i),this._pt=MTools.ifInstanceOf(t,MPoint,null),this._icon=MTools.ifInstanceOf(i.icon,MIcon,null),this._shadow=MTools.ifInstanceOf(i.shadow,MIcon,null),this._label=MTools.ifInstanceOf(i.label,MLabel,null),this._editable=MTools.ifUndefined(i.editable,!1),this._map=null},MMarker.prototype.paint=function(){if(this._map&&this._pt){var t=this._map.toPixel(this._pt);this._icon.paint(t),this._shadow&&this._shadow.paint(t),this._label&&this._label.paint(t),this._infowindow&&this._infowindow.opening()&&this._infowindow.paint(this._getInfoWindowPosition())}},MMarker.prototype.setMap=function(t){MOverlay.prototype.setMap.call(this,t),this._pt||(this._pt=this._map.center()),this._icon||(this._icon=new MIcon),this._icon.overlay()||this._icon.setOverlay(this),this._icon.setMap(this._map),this._shadow&&(this._shadow.overlay()||this._shadow.setOverlay(this),this._shadow.toShadow(),this._shadow._isDefaultAnchor&&(this._shadow.setAnchor(this._shadow._anchor.clone()),this._shadow._isDefaultAnchor=!0),this._shadow.setMap(this._map)),this._label&&(this._label.overlay()||this._label.setOverlay(this),this._label.setMap(this._map)),this._infowindow instanceof MInfoWindowView&&this._infowindow.setMap(this._map),this._bindIconEvent()},MMarker.prototype.map=function(){return this._map},MMarker.prototype.show=function(){this._icon&&this._icon.show(),this._label&&this._label.show(),this._shadow&&this._shadow.show()},MMarker.prototype.hide=function(){this._icon&&this._icon.hide(),this._label&&this._label.hide(),this._shadow&&this._shadow.hide()},MMarker.prototype.visible=function(){return this._icon&&this._icon.visible()},MMarker.prototype.remove=function(){this._icon instanceof MIcon&&this._icon.remove(),this._shadow instanceof MIcon&&this._shadow.remove(),this._label instanceof MLabel&&this._label.remove(),this._infowindow instanceof MInfoWindowView&&this._map&&this._map.removeInfoWindow(this._infowindow),this._map=null},MMarker.prototype.editable=function(){return this._editable},MMarker.prototype.setEditable=function(t){this._editable=t},MMarker.prototype.icon=function(){return this._icon},MMarker.prototype.setIcon=function(t){t instanceof MIcon&&t!==this._icon&&(this._icon instanceof MIcon&&this._icon.remove(),this._icon=t,this._map&&(this._icon.setOverlay(this),this._icon.setMap(this._map),this._icon.paint(),this._bindIconEvent()))},MMarker.prototype.label=function(){return this._label},MMarker.prototype.setLabel=function(t){t instanceof MLabel&&t!==this._label&&(this._label instanceof MLabel&&this._label.remove(),this._label=t,this._map&&(this._label.setOverlay(this),this._label.setMap(this._map),this._label.paint()))},MMarker.prototype.point=function(){return this._pt},MMarker.prototype.bounds=function(){return this._bounds||(this._bounds=new MBounds(new MPoint(this._pt.lng,this._pt.lat),new MPoint(this._pt.lng,this._pt.lat))),this._bounds},MMarker.prototype.setPoint=function(t){t instanceof MPoint&&!t.equals(this._pt)&&(this._pt=t,this._clearBounds(),this.paint())},MMarker.prototype.openInfoWindow=function(t){MOverlay.prototype.openInfoWindow.apply(this,arguments),this._infowindow.open(this._getInfoWindowPosition())},MMarker.prototype.setTop=function(){if(this._map){var t=this._map.nextMarkerZIndex();this._zIndex=t,this._icon&&this._icon.setZIndex(t),this._shadow&&this._shadow.setZIndex(t),this._label&&this._label.setZIndex(t)}},MMarker.prototype.finalize=function(){MEvent.clear(this),this._icon instanceof MIcon&&this._icon.finalize(),this._shadow instanceof MIcon&&this._shadow.finalize(),this._label instanceof MLabel&&this._label.finalize(),this._infowindow instanceof MInfoWindowView&&this._map&&this._map.removeInfoWindow(this._infowindow),this._infowindow instanceof MInfoWindowView&&this._infowindow.finalize(),MOverlay.prototype.finalize.apply(this)},MMarker.prototype._onclick=function(t){MEvent.trigger(this,"click")},MMarker.prototype._onmouseover=function(t){MEvent.trigger(this,"mouseover")},MMarker.prototype._onmouseout=function(t){MEvent.trigger(this,"mouseout")},MMarker.prototype._getInfoWindowPosition=function(){var t=this._map.toPixel(this._pt);return new MPixel(t.x,t.y-this._icon.size().height)},MMarker.prototype._bindIconEvent=function(){MEvent.bind(this._icon,"click",this._onclick,this),MEvent.bind(this._icon,"mouseover",this._onmouseover,this),MEvent.bind(this._icon,"mouseout",this._onmouseout,this)};var MPanel=MClass.create("MPanel",MObject);MPanel._serialNum=0,MPanel.initialize=function(t){this._createSerialNum(),this._initOptions(t),this._map=void 0,this._dom=void 0,this._$dom=void 0},MPanel.prototype.id=function(){return this._serialNum},MPanel.prototype.map=function(){return this._map},MPanel.prototype.setMap=function(t){t instanceof MMap&&(this._map=t)},MPanel.prototype.zIndex=function(){return this._zIndex},MPanel.prototype.setZIndex=function(t){"number"==typeof t&&(this._zIndex=t,this._dom&&this._$dom.setCss({zIndex:t}))},MPanel.prototype.remove=function(){this._map=void 0,this._$dom.remove()},MPanel.prototype.show=function(){this._dom&&this._$dom.show()},MPanel.prototype.hide=function(){this._dom&&this._$dom.hide()},MPanel.prototype.visible=function(){return this._dom&&"none"===this._$dom.css("display")},MPanel.prototype.allowedClear=function(){return this._allowedClear},MPanel.prototype.setAllowedClear=function(t){this._allowedClear="boolean"!=typeof t||t},MPanel.prototype.finalize=function(){this.remove(),MObject.prototype.finalize.apply(this,arguments)},MPanel.prototype._createSerialNum=function(){this._serialNum="panel"+MPanel._serialNum++},MPanel.prototype._initOptions=function(t){t=t||{},this._zIndex=MTools.ifTypeOf(t.zIndex,"number",0),this._allowedClear=MTools.ifTypeOf(t.allowedClear,"boolean",!0)};var MFloatPanel=MClass.create("MFloatPanel",MPanel);MFloatPanel.initialize=function(t,i){MPanel.initialize.call(this,i),this._content=t,this._size=new MSize(0,0)},MFloatPanel.prototype.setMap=function(t){MPanel.prototype.setMap.apply(this,arguments),this._initStruct(this._content),this._$dom.appendTo(this._map._floatPanelContainer),this._bindMapEvent(),this._setDefaultStyle()},MFloatPanel.prototype.remove=function(){MPanel.prototype.remove.apply(this,arguments),this._bindMapEvent(!0)},MFloatPanel.prototype.position=function(){return this._position},MFloatPanel.prototype.setPosition=function(t){this._position=t,this._setPosition()},MFloatPanel.prototype.marginX=function(){return this._marginX},MFloatPanel.prototype.marginY=function(){return this._marginY},MFloatPanel.prototype.setMargins=function(t,i){"number"==typeof t&&(this._marginX=t),"number"==typeof i&&(this._marginY=i)},MFloatPanel.prototype.setTop=function(){this._map instanceof MMap&&this._$dom.setCss({zIndex:this._map._nextFloatPanelZIndex()})},MFloatPanel.prototype.finalize=function(){MPanel.prototype.finalize.apply(this,arguments)},MFloatPanel.prototype._bindMapEvent=function(t){var i=MEvent[t?"unbind":"bind"];i(this._map,"resize",this._mapResize,this)},MFloatPanel.prototype._mapResize=function(){this._paint()},MFloatPanel.prototype._paint=function(){this._setPosition()},MFloatPanel.prototype._initStruct=function(t){this._dom||(this._$dom=MElement.create$("div"),this._dom=this._$dom.get(0),t&&(MElement.isElement(t)?this._$dom.append(t):this._$dom.html(t)))},MFloatPanel.prototype._setDefaultStyle=function(){this._$dom.setCss({position:"absolute",margin:0,padding:0}),this._size=this._$dom.outerSize(),this._setPosition()},MFloatPanel.prototype._setPosition=function(t){if(this._map){var i=this._position==MPositionType.LEFT_TOP||this._position==MPositionType.RIGHT_TOP,e=this._position==MPositionType.LEFT_BOTTOM||this._position==MPositionType.RIGHT_BOTTOM,o=this._position==MPositionType.LEFT_TOP||this._position==MPositionType.LEFT_BOTTOM,n=this._position==MPositionType.RIGHT_TOP||this._position==MPositionType.RIGHT_BOTTOM,s=t||this._map.size(),a=this._size,r={};i&&(r.top=this._marginY+"px"),o&&(r.left=this._marginX+"px"),e&&(r.top=s.height-a.height-this._marginY+"px"),n&&(r.left=s.width-a.width-this._marginX+"px"),this._$dom.setCss(r)}},MFloatPanel.prototype._initOptions=function(t){t=t||{},MPanel.prototype._initOptions.apply(this,arguments),this._position=MTools.ifUndefined(t.position,MPositionType.LEFT_BOTTOM),this._marginX=MTools.ifUndefined(t.marginX,10),this._marginY=MTools.ifUndefined(t.marginY,10)};var MPinPanel=MClass.create("MPinPanel",MPanel);MPinPanel.initialize=function(t,i,e){MPanel.initialize.call(this,e),this.setPoint(t),this.setContent(i)},MPinPanel.prototype.setMap=function(t){MPanel.prototype.setMap.apply(this,arguments),this._initStruct(),this._$dom.appendTo(this._map._pinPanelContainer),this._bindEvent(),this.paint()},MPinPanel.prototype.remove=function(){MPanel.prototype.remove.apply(this)},MPinPanel.prototype.point=function(){return this._pt},MPinPanel.prototype.setPoint=function(t){this._pt=MTools.ifInstanceOf(t,MPoint,null),this.paint()},MPinPanel.prototype.content=function(){return this._content},MPinPanel.prototype.setContent=function(t){this._content=t,this._setContent()},MPinPanel.prototype.paint=function(){if(this._map instanceof MMap&&this._pt instanceof MPoint){var t=this._map.toPixel(this._pt);this._$dom.setCss({top:t.y+"px",left:t.x+"px"})}},MPinPanel.prototype.setTop=function(){this._map instanceof MMap&&this._$dom.setCss({zIndex:this._map._nextPinPanelZIndex()})},MPinPanel.prototype._initStruct=function(){this._dom||(this._$dom=MElement.create$("div").setCss({position:"absolute",width:0,height:0}),this._dom=this._$dom.get(0),this._setContent())},MPinPanel.prototype._bindEvent=function(t){var i=MEvent[t?"unbind":"bind"];i(this._dom,"click",this._onClick,this),i(this._dom,"mousedown",this._preventEvent,this),i(this._dom,"mouseup",this._preventEvent,this),i(this._dom,"dblclick",this._preventEvent,this),i(this._dom,"touchstart",this._onTouchStart,this),i(this._dom,"touchend",this._onTouchEnd,this)},MPinPanel.prototype._onTouchStart=function(t){t.stopPropagation();var i=t.e.touches[0];this._touchPixel=new MPixel(i.pageX,i.pageY)},MPinPanel.prototype._onTouchEnd=function(t){t.stopPropagation();var i=t.e.changedTouches[0];Math.abs(i.pageX-this._touchPixel.x)<=10&&Math.abs(i.pageY-this._touchPixel.y)<=10&&MEvent.trigger(this,"click")},MPinPanel.prototype._preventEvent=function(t){t.preventDefault(),t.stopPropagation()},MPinPanel.prototype._onClick=function(t){t.stopPropagation(),MEvent.trigger(this,"click")},MPinPanel.prototype._setContent=function(){if(this._dom){var t=this._content;t&&(MElement.isElement(t)?(this._$dom.empty(),this._$dom.append(t)):this._$dom.html(t))}};var MPolyline=MClass.create("MPolyline",MOverlay);MPolyline.initialize=function(t,i){MOverlay.initialize.call(this,i),this._pts=t instanceof Array?t:[],this._visible=!0,this._zIndex=0,this._paintContext=void 0},MPolyline.prototype.paint=function(){MTools.supportSVG?MPolyline.prototype.paint=function(){if(this._map instanceof MMap&&this._visible){for(var t,i,e=this._pts,o=[],n=[],s=0,a=e.length;s<a;s++)i=e[s],this._map.checkLevelGroup(i)&&o.push(this._map.toPixel(i));o=this._clipLine(o);for(var r=0,h=o.length;r<h;r++)t=o[r],n.push(n.length>0?t.x+" "+t.y:"M"+t.x+" "+t.y);this._canvas.setAttr({"stroke-linejoin":"round","stroke-linecap":"round",stroke:this._color,"stroke-width":this._weight,"stroke-opacity":this._opacity,"stroke-dasharray":this._getDashArray().join(" "),fill:"none",d:n.length>0?n.join(" L"):"M0 0"})}}:MPolyline.prototype.paint=function(){if(this._map instanceof MMap&&this._visible){for(var t,i,e,o,n,s,a=this._pts,r=[],h=0,l=a.length;h<l;h++)s=a[h],this._map.checkLevelGroup(s)&&(t=this._map.toPixel(s),i="undefined"==typeof i?t.x:Math.min(t.x,i),e="undefined"==typeof e?t.y:Math.min(t.y,e),o="undefined"==typeof o?t.x:Math.max(t.x,o),n="undefined"==typeof n?t.y:Math.max(t.y,n),r.push(t));if(r=this._clipLine(r),this._range instanceof MPixelBounds){var p=this._range.min,_=this._range.size();MTools.clearCanvas(this._paintContext,p,_)}MTools.paintLine(this._paintContext,r,this.lineStyle()),this._range=new MPixelBounds(new MPixel(i-this._weight,e-this._weight),new MPixel(o+this._weight,n+this._weight))}},this.paint()},MPolyline.prototype.lineStyle=function(){return{strokeStyle:MTools.colorRgb(this._color,this._opacity),lineWidth:this._weight,lineCap:"round",lineJoin:"round"}},MPolyline.prototype.show=function(){this._canvas.show(),this._visible=!0,this.paint()},MPolyline.prototype.hide=function(){this._canvas.hide(),this._visible=!1},MPolyline.prototype.visible=function(){return this._visible},MPolyline.prototype.remove=function(){this._canvas.remove(),this._canvas=null,this._paintContext=null,this._map=null,MEvent.unbind(this._map,"resize",this._onMapResize)},MPolyline.prototype.points=function(){return this._pts},MPolyline.prototype.setPoints=function(t){t instanceof Array&&t.length>1&&(this._pts=t,this._clearBounds(),this.paint())},MPolyline.prototype.color=function(){return this._color},MPolyline.prototype.setColor=function(t){this._setColor(t,!0)},MPolyline.prototype.weight=function(){return this._weight},MPolyline.prototype.setWeight=function(t){"number"==typeof t&&this._weight!==t&&(this._weight=t,this.paint())},MPolyline.prototype.opacity=function(){return this._opacity},MPolyline.prototype.setOpacity=function(t){"number"==typeof t&&this._opacity!==t&&(this._opacity=t,this.paint())},MPolyline.prototype.setMap=function(t){MOverlay.prototype.setMap.call(this,t),this._createCanvas(),MEvent.bind(this._map,"resize",this._onMapResize,this)},MPolyline.prototype.bounds=function(){if(!this._bounds&&this._pts.length){for(var t,i,e,o,n,s,a=0,n=this._pts.length;a<n;a++)s=this._pts[a],a?(t=Math.max(t,s.lng),i=Math.max(i,s.lat),e=Math.min(e,s.lng),o=Math.min(o,s.lat)):(t=e=s.lng,i=o=s.lat);this._bounds=new MBounds(new MPoint(e,o),new MPoint(t,i))}return this._bounds},MPolyline.prototype.setTop=function(){},MPolyline.prototype.finalize=function(){this.remove(),MOverlay.prototype.finalize.apply(this)},MPolyline.prototype._clipLine=function(t){if(t instanceof Array&&this._map){var i,e=this._map.size(),o=e.width,n=e.height,s=new MPixelBounds(new MPixel((-o),(-n)),new MPixel(2*o,2*n)),a=[];i={px1:t[0].clone(),px2:t[1].clone()},MTools.cohenSutherland(i,s)&&(a=[i.px1,i.px2]);for(var r=1,h=t.length-1;r<h;r++)i={px1:t[r].clone(),px2:t[r+1].clone()},MTools.cohenSutherland(i,s)&&(i.px1!==t[r]&&a.push(i.px1),a.push(i.px2));return a}return null},MPolyline.prototype._onMapResize=function(t,i){MTools.supportSVG?MPolyline.prototype._onMapResize=function(t,i){this.paint()}:MPolyline.prototype._onMapResize=function(t,i){this._canvas.setAttr({width:3*i.width,height:3*i.height}).setCss({top:-i.height+"px",left:-i.width+"px"}),this._paintContext.restore(),this._paintContext.save(),this._paintContext.translate(i.width,i.height)},this._onMapResize(t,i)},MPolyline.prototype._createCanvas=function(){MTools.supportSVG?MPolyline.prototype._createCanvas=function(){this._canvas=MElement.createSVG$("path").appendTo(this._map._svgContainer)}:MPolyline.prototype._createCanvas=function(){var t=this._map.size(),i=t.width,e=t.height;if(this._canvas=MElement.create$("canvas").setAttr({width:3*i,height:3*e}).setCss({position:"absolute",top:-e+"px",left:-i+"px"}).appendTo(this._map._canvasContainer),!this._canvas.get(0).getContext)throw this._paintContext=void 0,new Error("browser does not support the canvas element");this._paintContext=this._canvas.get(0).getContext("2d"),this._paintContext.save(),this._paintContext.translate(i,e)},this._createCanvas()},MPolyline.prototype._getDashArray=function(){var t=[];switch(this._strokeStyle){case MStrokeStyle.DOTTED:t=[.1,3*this._weight];break;case MStrokeStyle.SHORTDOTTED:t=[.1,2*this._weight];break;case MStrokeStyle.DASHED:t=[3*this._weight,3*this._weight];break;case MStrokeStyle.SHORTDASHED:t=[3*this._weight,2*this._weight];break;case MStrokeStyle.LONGDASHED:t=[5*this._weight,2*this._weight];break;case MStrokeStyle.DOTDASHED:t=[4*this._weight,3*this._weight,1,3*this._weight];break;case MStrokeStyle.SHORTDOTDASHED:t=[3*this._weight,2*this._weight,.1,2*this._weight];break;case MStrokeStyle.LONGDOTDASHED:t=[6*this._weight,3*this._weight,1,3*this._weight]}return t},MPolyline.prototype._setColor=function(t,i){t!==this._color&&(this._color=t,i&&this.paint())},MPolyline.prototype._initOptions=function(t){t=t||{},MOverlay.prototype._initOptions.apply(this,arguments),this._strokeStyle=MTools.ifUndefined(t.strokeStyle,MStrokeStyle.SOLID),this._color=MTools.ifUndefined(t.color,"#FF0000"),this._weight=MTools.ifUndefined(t.weight,4),this._opacity=MTools.ifUndefined(t.opacity,.6),this._opacity=MTools.between(this._opacity,0,1,.6),this._editable=MTools.ifUndefined(t.editable,!1)};var MPolygon=MClass.create("MPolygon",MOverlay);MPolygon.initialize=function(t,i){MOverlay.initialize.call(this,i),this._pts=t instanceof Array?t:[],this._visible=!0,this._zIndex=0,this._paintContext=void 0},MPolygon.prototype.paint=function(){MTools.supportSVG?MPolygon.prototype.paint=function(){if(this._map instanceof MMap&&this._visible){for(var t,i,e=this._pts,o=[],n=[],s=0,a=e.length;s<a;s++)i=e[s],this._map.checkLevelGroup(i)&&o.push(this._map.toPixel(i));o=this._clipPolygon(o);for(var r=0,h=o.length;r<h;r++)t=o[r],n.push(n.length>0?t.x+" "+t.y:"M"+t.x+" "+t.y);this._canvas.setAttr({"stroke-linejoin":"round","stroke-linecap":"round",stroke:this._color,"stroke-width":this._weight,"fill-opacity":this._fillOpacity,"stroke-opacity":this._opacity,"stroke-dasharray":this._getDashArray().join(" "),fill:this._fillColor,d:n.length>0?n.join(" L")+" Z":"M0 0"})}}:MPolygon.prototype.paint=function(){if(this._map instanceof MMap&&this._visible){for(var t,i,e,o,n,s,a=this._pts,r=[],h=0,l=a.length;h<l;h++)s=a[h],this._map.checkLevelGroup(s)&&(t=this._map.toPixel(s),i="undefined"==typeof i?t.x:Math.min(t.x,i),e="undefined"==typeof e?t.y:Math.min(t.y,e),o="undefined"==typeof o?t.x:Math.max(t.x,o),n="undefined"==typeof n?t.y:Math.max(t.y,n),r.push(t));if(r=this._clipPolygon(r),this._range instanceof MPixelBounds){var p=this._range.min,_=this._range.size();MTools.clearCanvas(this._paintContext,p,_)}MTools.paintLine(this._paintContext,r,this.lineStyle(),!0),this._range=new MPixelBounds(new MPixel(i-this._weight,e-this._weight),new MPixel(o+this._weight,n+this._weight))}},this.paint()},MPolygon.prototype.lineStyle=function(){return{strokeStyle:MTools.colorRgb(this._color,this._opacity),lineWidth:this._weight,lineCap:"round",lineJoin:"round",fillStyle:MTools.colorRgb(this._fillColor,this._fillOpacity)}},MPolygon.prototype.show=function(){this._canvas.show(),this._visible=!0,this.paint()},MPolygon.prototype.hide=function(){this._canvas.hide(),this._visible=!1},MPolygon.prototype.visible=function(){return this._visible},MPolygon.prototype.remove=function(){this._canvas.remove(),this._canvas=null,this._paintContext=null,this._map=null,MEvent.unbind(this._map,"resize",this._onMapResize)},MPolygon.prototype.points=function(){return this._pts},MPolygon.prototype.setPoints=function(t){t instanceof Array&&t.length>1&&(this._pts=t,this._clearBounds(),this.paint())},MPolygon.prototype.color=function(){return this._color},MPolygon.prototype.setColor=function(t){this._setColor(t,!0)},MPolygon.prototype.fillColor=function(){return this._fillColor},MPolygon.prototype.setFillColor=function(t){this._setFillColor(t,!0)},MPolygon.prototype.weight=function(){return this._weight},MPolygon.prototype.setWeight=function(t){
"number"==typeof t&&this._weight!==t&&(this._weight=t,this.paint())},MPolygon.prototype.opacity=function(){return this._opacity},MPolygon.prototype.setOpacity=function(t){"number"==typeof t&&this._opacity!==t&&(this._opacity=t,this.paint())},MPolygon.prototype.fillOpacity=function(){return this._fillOpacity},MPolygon.prototype.setFillOpacity=function(t){"number"==typeof t&&this._fillOpacity!==t&&(this._fillOpacity=t,this.paint())},MPolygon.prototype.setMap=function(t){MOverlay.prototype.setMap.call(this,t),this._createCanvas(),MEvent.bind(this._map,"resize",this._onMapResize,this)},MPolygon.prototype.bounds=function(){if(!this._bounds&&this._pts.length){for(var t,i,e,o,n,s,a=0,n=this._pts.length;a<n;a++)s=this._pts[a],a?(t=Math.max(t,s.lng),i=Math.max(i,s.lat),e=Math.min(e,s.lng),o=Math.min(o,s.lat)):(t=e=s.lng,i=o=s.lat);this._bounds=new MBounds(new MPoint(e,o),new MPoint(t,i))}return this._bounds},MPolygon.prototype.setTop=function(){},MPolygon.prototype.finalize=function(){this.remove(),MOverlay.prototype.finalize.apply(this)},MPolygon.prototype._clipPolygon=function(t){if(t instanceof Array&&this._map){var i=this._map.size(),e=i.width,o=i.height,n=new MPixelBounds(new MPixel((-e),(-o)),new MPixel(2*e,2*o));return MTools.sutherlandHodgman(t,n)}return null},MPolygon.prototype._onMapResize=function(t,i){MTools.supportSVG?MPolygon.prototype._onMapResize=function(t,i){this.paint()}:MPolygon.prototype._onMapResize=function(t,i){this._canvas.setAttr({width:3*i.width,height:3*i.height}).setCss({top:-i.height+"px",left:-i.width+"px"}),this._paintContext.restore(),this._paintContext.save(),this._paintContext.translate(i.width,i.height)},this._onMapResize(t,i)},MPolygon.prototype._createCanvas=function(){MTools.supportSVG?MPolygon.prototype._createCanvas=function(){this._canvas=MElement.createSVG$("path").appendTo(this._map._svgContainer)}:MPolygon.prototype._createCanvas=function(){var t=this._map.size(),i=t.width,e=t.height;if(this._canvas=MElement.create$("canvas").setAttr({width:3*i,height:3*e}).setCss({position:"absolute",top:-e+"px",left:-i+"px"}).appendTo(this._map._canvasContainer),!this._canvas.get(0).getContext)throw this._paintContext=void 0,new Error("browser does not support the canvas element");this._paintContext=this._canvas.get(0).getContext("2d"),this._paintContext.save(),this._paintContext.translate(i,e)},this._createCanvas()},MPolygon.prototype._getDashArray=function(){var t=[];switch(this._strokeStyle){case MStrokeStyle.DOTTED:t=[.1,3*this._weight];break;case MStrokeStyle.SHORTDOTTED:t=[.1,2*this._weight];break;case MStrokeStyle.DASHED:t=[3*this._weight,3*this._weight];break;case MStrokeStyle.SHORTDASHED:t=[3*this._weight,2*this._weight];break;case MStrokeStyle.LONGDASHED:t=[5*this._weight,2*this._weight];break;case MStrokeStyle.DOTDASHED:t=[4*this._weight,3*this._weight,1,3*this._weight];break;case MStrokeStyle.SHORTDOTDASHED:t=[3*this._weight,2*this._weight,.1,2*this._weight];break;case MStrokeStyle.LONGDOTDASHED:t=[6*this._weight,3*this._weight,1,3*this._weight]}return t},MPolygon.prototype._setColor=function(t,i){t!==this._color&&(this._color=t,i&&this.paint())},MPolygon.prototype._setFillColor=function(t,i){t!==this._fillColor&&(this._fillColor=t,i&&this.paint())},MPolygon.prototype._initOptions=function(t){t=t||{},MOverlay.prototype._initOptions.apply(this,arguments),this._strokeStyle=MTools.ifUndefined(t.strokeStyle,MStrokeStyle.SOLID),this._color=MTools.ifUndefined(t.color,"#FF0000"),this._fillColor=MTools.ifUndefined(t.fillColor,"#FF0000"),this._weight=MTools.ifUndefined(t.weight,4),this._opacity=MTools.ifUndefined(t.opacity,.6),this._opacity=MTools.between(this._opacity,0,1,.6),this._fillOpacity=MTools.ifUndefined(t.fillOpacity,.4),this._fillOpacity=MTools.between(this._fillOpacity,0,1,.4),this._editable=MTools.ifUndefined(t.editable,!1)};var MCircle=MClass.create("MCircle",MOverlay);MCircle.initialize=function(t,i,e){MOverlay.initialize.apply(this,[e]),this._paintContext=void 0,this._center=void 0,this._radius=void 0,this._visible=!0,this.setCenter(t),this.setRadius(i)},MCircle.prototype.center=function(){return this._center},MCircle.prototype.setCenter=function(t){t instanceof MPoint&&!t.equals(this._center)&&(this._center=t,this._clearBounds(),this.paint())},MCircle.prototype.radius=function(){return this._radius},MCircle.prototype.setRadius=function(t){"number"==typeof t&&t!==this._radius&&(this._radius=t,this._clearBounds(),this.paint())},MCircle.prototype.color=function(){return this._color},MCircle.prototype.setColor=function(t){"string"==typeof t&&t!==this._color&&(this._color=t,this.paint())},MCircle.prototype.fillColor=function(){return this._fillColor},MCircle.prototype.setFillColor=function(t){"string"==typeof t&&t!==this._fillColor&&(this._fillColor=t,this.paint())},MCircle.prototype.weight=function(){return this._weight},MCircle.prototype.setWeight=function(t){"number"==typeof t&&t!==this._weight&&(this._weight=t,this.paint())},MCircle.prototype.opacity=function(){return this._opacity},MCircle.prototype.setOpacity=function(t){"number"==typeof t&&t!==this._opacity&&(this._opacity=t,this.paint())},MCircle.prototype.fillOpacity=function(){return this._fillOpacity},MCircle.prototype.setFillOpacity=function(t){"number"==typeof t&&t!==this._fillOpacity&&(this._fillOpacity=t,this.paint())},MCircle.prototype.setMap=function(t){MOverlay.prototype.setMap.call(this,t),this._createCanvas(),MEvent.bind(this._map,"resize",this._onMapResize,this)},MCircle.prototype.bounds=function(){if(!this._bounds){var t=this._radius/111111,i=new MPoint(this._center.lng,this._center.lat-t),e=this._map.toPixel(this._center),o=this._map.toPixel(i),n=o.y-e.y,s=this._map.toPoint(e.x-n,e.y-n),a=this._map.toPoint(e.x+n,e.y+n);this._bounds=new MBounds(s,a)}return this._bounds},MCircle.prototype.visible=function(){return this._visible},MCircle.prototype.hide=function(){this._canvas.hide(),this._visible=!1},MCircle.prototype.show=function(){this._canvas.show(),this._visible=!0,this.paint()},MCircle.prototype.paint=function(){MTools.supportSVG?MCircle.prototype.paint=function(){if(this._map&&this._center&&this._radius&&this._visible){var t=this._radius/111111,i=new MPoint(this._center.lng,this._center.lat-t),e=this._map.toPixel(this._center),o=this._map.toPixel(i),n=o.y-e.y;this._canvas.setAttr({cx:e.x,cy:e.y,r:n,stroke:this._color,"stroke-width":this._weight,fill:this._fillColor,"stroke-opacity":this._opacity,"fill-opacity":this._fillOpacity})}}:MCircle.prototype.paint=function(){if(this._map&&this._center&&this._radius&&this._paintContext&&this._visible){var t=this._radius/111111,i=new MPoint(this._center.lng,this._center.lat-t),e=this._map.toPixel(this._center),o=this._map.toPixel(i),n=o.y-e.y,s=MTools.colorRgb(this._color,this._opacity),a=MTools.colorRgb(this._fillColor,this._fillOpacity);if(this._range instanceof MPixelBounds){var r=this._range.min,h=this._range.size();MTools.clearCanvas(this._paintContext,r,h)}MTools.paintCircle(this._paintContext,e,n,!0,!0,{strokeStyle:s,lineWidth:this._weight,fillStyle:a}),this._range=new MPixelBounds(new MPixel(e.x-n-this._weight,e.y-n-this._weight),new MPixel(e.x+n+this._weight,e.y+n+this._weight))}},this.paint()},MCircle.prototype.borderStyle=function(){return{strokeStyle:MTools.colorRgb(this._color,this._opacity),lineWidth:this._weight}},MCircle.prototype.fillStyle=function(){return{fillStyle:MTools.colorRgb(this._fillColor,this._fillOpacity)}},MCircle.prototype.setTop=function(){},MCircle.prototype.remove=function(){this._canvas.remove(),this._canvas=null,this._paintContext=null,this._map=null,MEvent.unbind(this._map,"resize",this._onMapResize)},MCircle.prototype.finalize=function(){this.remove(),MOverlay.prototype.finalize.apply(this)},MCircle.prototype._onMapResize=function(t,i){MTools.supportSVG?MCircle.prototype._onMapResize=function(t,i){this.paint()}:MCircle.prototype._onMapResize=function(t,i){this._canvas.setAttr({width:3*i.width,height:3*i.height}).setCss({top:-i.height+"px",left:-i.width+"px"}),this._paintContext.restore(),this._paintContext.save(),this._paintContext.translate(i.width,i.height)},this._onMapResize(t,i)},MCircle.prototype._createCanvas=function(){MTools.supportSVG?MCircle.prototype._createCanvas=function(){this._canvas=MElement.createSVG$("circle").appendTo(this._map._svgContainer)}:MCircle.prototype._createCanvas=function(){var t=this._map.size(),i=t.width,e=t.height;if(this._canvas=MElement.create$("canvas").setAttr({width:3*i,height:3*e}).setCss({position:"absolute",top:-e+"px",left:-i+"px"}).appendTo(this._map._canvasContainer),!this._canvas.get(0).getContext)throw this._paintContext=void 0,new Error("browser does not support the canvas element");this._paintContext=this._canvas.get(0).getContext("2d"),this._paintContext.save(),this._paintContext.translate(i,e)},this._createCanvas()},MCircle.prototype._initOptions=function(t){t=t||{},MOverlay.prototype._initOptions.apply(this,arguments),this._color=MTools.ifUndefined(t.color,"#F00"),this._fillColor=MTools.ifUndefined(t.fillColor,"#F00"),this._weight=MTools.ifUndefined(t.weight,2),this._opacity=MTools.ifUndefined(t.opacity,.6),this._fillOpacity=MTools.ifUndefined(t.fillOpacity,.3),this._editable=MTools.ifUndefined(t.editable,!1)};var MInfoWindowView=MClass.create("MInfoWindowView",MObject);MInfoWindowView.initialize=function(t,i){this._initOptions(i),this._owner=null,this._map=null,this._dom=void 0,this._opening=!1,this._content=t,this._position=null,this._size=null,this._serialNum=null},MInfoWindowView._serialNum=0,MInfoWindowView.prototype.id=function(){return this._serialNum||this._createSerialNum(),this._serialNum},MInfoWindowView.prototype.dom=function(){return this._dom},MInfoWindowView.prototype.owner=function(){return this._owner},MInfoWindowView.prototype.setOwner=function(t){this._owner=t},MInfoWindowView.prototype.map=function(){return this._map},MInfoWindowView.prototype.setMap=function(t){t instanceof MMap&&(this._map=t)},MInfoWindowView.prototype.opening=function(){return this._opening},MInfoWindowView.prototype.open=function(t){this.setPosition(t)},MInfoWindowView.prototype.close=function(){},MInfoWindowView.prototype.content=function(){return this._content},MInfoWindowView.prototype.setContent=function(t){this._content=t},MInfoWindowView.prototype.position=function(){return this._position},MInfoWindowView.prototype.setPosition=function(t){t instanceof MPixel&&!t.equals(this._position)&&(this._position=t)},MInfoWindowView.prototype.paint=function(t){this.setPosition(t)},MInfoWindowView.prototype.size=function(){return this._size},MInfoWindowView.prototype.resize=function(t){t instanceof MSize&&!t.equals(this._size)&&(this._size=t)},MInfoWindowView.prototype.remove=function(){},MInfoWindowView.prototype.finalize=function(){this.remove(),MObject.prototype.finalize.apply(this,arguments)},MInfoWindowView.prototype._createSerialNum=function(){this._serialNum="iw"+MInfoWindowView._serialNum++},MInfoWindowView.prototype._initOptions=function(t){};var MInfoWindow=MClass.create("MInfoWindow",MInfoWindowView);MInfoWindow.initialize=function(t,i){MInfoWindowView.initialize.apply(this,arguments),this._mapPadding=10,this._dis=2,this._cPadding={top:10,right:10,bottom:10,left:10},this._borderRadius=5,this._cBorder=1,this._arrowSize=new MSize(15,8)},MInfoWindow.prototype.open=function(t){this._dom?this._$dom.show():(this._initStruct(),this._applyContent(),this._map.addInfoWindow(this),this._drawArrow()),this.setPosition(t||this._position),this._updateUI(!0),this._opening=!0,MEvent.trigger(this,"opened")},MInfoWindow.prototype.close=function(t){t=MTools.ifUndefined(t,!0),this._$dom.hide(),this._opening=!1,!this._owner&&t&&this.finalize(),MEvent.trigger(this,"closed")},MInfoWindow.prototype.setContent=function(t){MInfoWindowView.prototype.setContent.apply(this,arguments),this._applyContent()},MInfoWindow.prototype.setPosition=function(t){if(t instanceof MPixel){var i=this._map.size(),e=i.width,o=i.height,n=new MPixelBounds(new MPixel((-e),(-o)),new MPixel(2*e,2*o));n.contains(t)?(MInfoWindowView.prototype.setPosition.apply(this,arguments),!arguments[1]&&(this._point=this._map.toPoint(t)),this._applyPosition()):this._$dom.hide()}},MInfoWindow.prototype.paint=function(t){t=t instanceof MPixel?t:this._map.toPixel(this._point),this.setPosition(t,!0),this._map._autoAdjustInfoWindowPosition&&this._updateUI()},MInfoWindow.prototype.resize=function(t){try{t instanceof MSize&&(MInfoWindowView.prototype.resize.call(this,t),this._cContainer.setCss({whiteSpace:"normal",width:t.width>0?t.width-this._cPadding.right-this._cPadding.left-2*this._cBorder+"px":"auto",height:t.height>0?t.height-this._cPadding.top-this._cPadding.bottom-2*this._cBorder+"px":"auto"}),this._updateUI(!0))}catch(t){alert(t.message)}},MInfoWindow.prototype.remove=function(){this._bindEvent(!0),MTools.removeNode(this._dom),this._dom=null,this._owner=null,this._map=null},MInfoWindow.prototype.finalize=function(){this.remove(),MInfoWindowView.prototype.finalize.apply(this,arguments)},MInfoWindow.prototype._initOptions=function(t){t=t||{},this._size=MTools.ifUndefined(t.size,void 0)},MInfoWindow.prototype._initStruct=function(){var t=this._size;this._$dom=MElement.create$("div").setCss({position:"absolute",width:0,height:0}),this._dom=this._$dom.get(0),this._cContainer=MElement.create$("div").setAttr({style:"background:#DEDEDE;background:-moz-linear-gradient(top, #FEFEFE, #DEDEDE);background:-webkit-linear-gradient(top, #FEFEFE, #DEDEDE);background:-webkit-gradient(linear, 0 0, 0 100%, from(#FEFEFE), to(#DEDEDE));"+(this._map._enabledHighResolution?"text-shadow:2px 2px #FFF;box-shadow:6px 6px 5px #999;-webkit-box-shadow:6px 6px 5px #999;":"text-shadow:1px 1px #FFF;box-shadow:3px 3px 5px #999;-webkit-box-shadow:3px 3px 5px #999;")}).setCss({position:"absolute",whiteSpace:"nowrap",border:(this._map._enabledHighResolution?2*this._cBorder:this._cBorder)+"px solid #666",padding:this._cPadding.top+"px "+this._cPadding.right+"px "+this._cPadding.bottom+"px "+this._cPadding.left+"px",borderRadius:this._borderRadius+"px",fontSize:this._map._enabledHighResolution?"24px":"12px"}).appendTo(this._dom),this._cContainer.addClass("MInfoWindow"),MClass.classOf(t,MSize)&&this._cContainer.setCss({width:t.width>0?t.width-this._cPadding.right-this._cPadding.left-2*this._cBorder+"px":"auto",height:t.height>0?t.height-this._cPadding.top-this._cPadding.bottom-2*this._cBorder+"px":"auto"}),this._arrow=MElement.create$("canvas").setAttr({width:this._map._enabledHighResolution?2*this._arrowSize.width:this._arrowSize.width,height:this._map._enabledHighResolution?2*this._arrowSize.height:this._arrowSize.height}).setCss({position:"absolute"}).appendTo(this._dom),this._bindEvent()},MInfoWindow.prototype._bindEvent=function(t){var i=t?MEvent.unbind:MEvent.bind;i(this._dom,"click",this._stopPropagation),i(this._dom,"dblclick",this._stopPropagation),i(this._dom,"touchstart",this._stopPropagation),this._map&&i(this._map,"click",this._mapClick,this)},MInfoWindow.prototype._stopPropagation=function(t){t.stopPropagation()},MInfoWindow.prototype._mapClick=function(t){this._map._closeInfoWindowOnMapClick&&this.close(!1)},MInfoWindow.prototype._applyContent=function(){this._cContainer&&(MElement.isElement(this._content)?this._cContainer.empty().append(this._content):"string"==typeof this._content&&this._cContainer.html(this._content))},MInfoWindow.prototype._applyPosition=function(){this._$dom.setCss({top:this._position.y-this._dis+"px",left:this._position.x+"px"}).show()},MInfoWindow.prototype._updateUI=function(t){var i=this._cContainer.outerSize(),e=this._map.size(),o=new MSize(e.width-2*this._mapPadding,e.height-2*this._mapPadding);if(o.width<i.width)this.resize(new MSize(o.width-5,0));else{var n={left:-(i.width/2)+"px",top:-i.height-this._arrowSize.height+(this._map._enabledHighResolution?2*this._cBorder:this._cBorder)+"px"},s=this._owner?this._owner.icon().size():new MSize(0,0),a=this._map.bounds();(this._position.x<0||this._position.x>e.width||this._position.y+this._dis+s.height<0||this._position.y>e.height)&&t&&this._map.setCenter(this._point);var r,h,l,p,_,d,c=this._position.x-this._mapPadding,u=e.width-this._position.x-this._mapPadding,M=(this._position.y-this._arrowSize.height-i.height-this._dis,e.height-this._position.y-this._dis-s.height-this._mapPadding,i.width/2),f=-M,m=5+this._arrowSize.width/2+this._cPadding.left,g=5+this._arrowSize.width/2+this._cPadding.right;c<M&&this._map._autoAdjustInfoWindowPosition&&(f=-(c<m?m:c),n.left=f+"px"),u<M&&this._map._autoAdjustInfoWindowPosition&&(f=-(u<g?2*M-g:2*M-u),n.left=f+"px"),r=this._position.x+f-this._mapPadding,h=this._position.y+s.height+this._mapPadding,l=this._position.x+i.width+f+this._mapPadding,p=this._position.y-this._arrowSize.height-i.height-this._dis-this._mapPadding,_=this._map.toPoint(r,h),d=this._map.toPoint(l,p),a.contains(_)&&a.contains(d)||!t||!this._map._panMapOnOpenInfoWindow||this._map.intoView(new MBounds(_,d)),this._cContainer.setCss(n),this._arrow.setCss({left:-Math.round((this._map._enabledHighResolution?2*this._arrowSize.width:this._arrowSize.width)/2)+"px",top:-this._arrowSize.height+"px"})}},MInfoWindow.prototype._drawArrow=function(){var t=this._arrow.get(0).getContext("2d"),i=parseInt(this._arrow.css("width")),e=parseInt(this._arrow.css("height"));t.save(),t.lineWidth=this._map._enabledHighResolution?2*this._cBorder:this._cBorder,t.strokeStyle="#000",t.beginPath(),t.moveTo(0,0),t.lineTo(Math.round(i/2),e),t.lineTo(i,0),t.stroke(),t.fillStyle="#DEDEDE",t.fill(),t.restore()};var MLabel=MClass.create("MLabel",MObject);MLabel.initialize=function(t,i){this._initOptions(i),this._content=t,this._overlay=null,this._dom=null,this._map=null,this._visible=!0},MLabel.prototype.map=function(){return this._map},MLabel.prototype.setMap=function(t){t instanceof MMap&&(this._map=t,this._buildDom())},MLabel.prototype.overlay=function(){return this._overlay},MLabel.prototype.setOverlay=function(t){t instanceof MOverlay&&(this._overlay=t)},MLabel.prototype.anchor=function(){return this._anchor},MLabel.prototype.setAnchor=function(t){t instanceof MPixel&&t.equals(this._anchor)},MLabel.prototype.paint=function(t){this._overlay&&this._map&&(this._dom.parentNode||this._$dom.appendTo(this._map._markerContainer),t=t||this._map.toPixel(this._overlay.point()),this._setLocation(t))},MLabel.prototype.content=function(){return this._text},MLabel.prototype.setContent=function(t){"string"==typeof t&&t!==this._text&&(this._text=t,this._dom&&this._$dom.html(t))},MLabel.prototype.visible=function(){return this._map&&this._dom&&this._visible},MLabel.prototype.show=function(){this.visible()||(this._visible=!0,this._dom&&this._map&&this._$dom.show())},MLabel.prototype.hide=function(){this.visible()&&(this._visible=!1,this._dom&&this._map&&this._$dom.hide())},MLabel.prototype.setZIndex=function(t){this._visible()&&"number"==typeof t&&this._$dom.setCss({zIndex:t})},MLabel.prototype.remove=function(){this._map&&this._dom&&(this._$dom.remove(),this._map=null)},MLabel.prototype.finalize=function(){this.remove(),MObject.prototype.finalize.apply(this)},MLabel.prototype._bindEvent=function(t){var i=t?MEvent.unbind:MEvent.bind;i(this._dom,"click",this._preventEvent,this),i(this._dom,"mousedown",this._preventEvent,this),i(this._dom,"mouseup",this._preventEvent,this),i(this._dom,"dblclick",this._preventEvent,this),i(this._dom,"touchstart",this._preventEvent,this),i(this._dom,"touchend",this._preventEvent,this)},MLabel.prototype._preventEvent=function(t){t.preventDefault(),t.stopPropagation()},MLabel.prototype._setLocation=function(t){var i=this._map.size(),e=i.width,o=i.height,n=new MPixelBounds(new MPixel((-e),(-o)),new MPixel(2*e,2*o));this._dom&&(n.contains(t)?this._$dom.setCss({left:t.x+this._anchor.x+"px",top:t.y+this._anchor.y+"px"}).show():this._$dom.hide())},MLabel.prototype._buildDom=function(){this._dom||(this._$dom=MElement.create$("div").setCss({position:"absolute",border:"none",whiteSpace:"nowrap"}).html(this._content),this._dom=this._$dom.get(0),this._bindEvent())},MLabel.prototype._initOptions=function(t){t=t||{},this._anchor=MTools.ifInstanceOf(t.anchor,MPixel,new MPixel(0,0))};var MCopyright=MClass.create("MCopyright",MFloatPanel);MCopyright.initialize=function(t){MFloatPanel.initialize.call(this,t.content,t),this._position=t.position},MCopyright.prototype._setDefaultStyle=function(){this._$dom.setCss({zIndex:1}),MFloatPanel.prototype._setDefaultStyle.call(this)},MCopyright.prototype._mapResize=function(t,i){this._setPosition(i)},MCopyright.prototype._setPosition=function(t){if(this._position===MPositionType.CENTER_BOTTOM){if(this._map){var i=t||this._map.size(),e=this._size,o={top:i.height-e.height-this._marginY+"px",left:Math.floor((i.width-e.width)/2)+"px"};this._$dom.setCss(o)}}else MFloatPanel.prototype._setPosition.call(this,t)},MCopyright.prototype._initOptions=function(t){t=t||{},t.allowedClear=!1,t.marginX=0,t.marginY=0,t.position=MTools.ifUndefined(t.position,MPositionType.CENTER_BOTTOM),MFloatPanel.prototype._initOptions.call(this,t)};var MStandardControl=MClass.create("MStandardControl",MFloatPanel);MStandardControl.initialize=function(t){this._min=!1,this._max=!1,this._geo=!1,MFloatPanel.initialize.call(this,null,t),this._setButtonSize()},MStandardControl.prototype.setMap=function(){MFloatPanel.prototype.setMap.apply(this,arguments),this._bindEvent()},MStandardControl.prototype.remove=function(){this._bindEvent(!0),MFloatPanel.prototype.remove.apply(this,arguments),this._map=null},MStandardControl.prototype.setMargins=function(t,i){MFloatPanel.prototype.setMargins.call(this,t,i),this._setPosition()},MStandardControl.prototype.finalize=function(){this._bindEvent(!0),this._$dom.remove(),MFloatPanel.prototype.finalize.apply(this,arguments)},MStandardControl.prototype._initStruct=function(){this._$dom=MElement.create$("div"),this._dom=this._$dom.get(0),this._geoBtn=this._createButton(),this._geoCtx=this._geoBtn.get(0).getContext("2d"),this._zoomInBtn=this._createButton(),this._zoomInCtx=this._zoomInBtn.get(0).getContext("2d"),this._zoomOutBtn=this._createButton(),this._zoomOutCtx=this._zoomOutBtn.get(0).getContext("2d"),this._btns=MElement.$$([this._geoBtn,this._zoomInBtn,this._zoomOutBtn])},MStandardControl.prototype._drawBackground=function(t,i){var e=t.canvas.width,o=t.canvas.height;t.save(),t.translate(Math.round(e/2),Math.round(o/2)),MTools.paintCircle(t,new MPixel(0,0),Math.round(Math.min(e,o)/2),!0,!1,{fillStyle:i}),t.restore()},MStandardControl.prototype._drawLocation=function(t,i,e){var o=t.canvas.width,n=t.canvas.height,s=Math.round(o/2),a=Math.round(n/2);this._drawBackground(t,e),t.save(),t.translate(s,a),MTools.paintLines(t,[[new MPixel(0,.37*-n),new MPixel(0,.37*n)],[new MPixel(.37*-o,0),new MPixel(.37*o,0)]],{lineCap:"round",strokeStyle:i,lineWidth:Math.round(o/7)}),MTools.paintCircle(t,new MPixel(0,0),Math.round(.35*o),!0,!1,{fillStyle:i}),MTools.paintCircle(t,new MPixel(0,0),Math.round(.25*o),!0,!1,{fillStyle:e}),MTools.paintCircle(t,new MPixel(0,0),Math.round(.18*o),!0,!1,{fillStyle:i}),t.restore()},MStandardControl.prototype._drawZoomIn=function(t,i,e){var o=t.canvas.width,n=t.canvas.height,s=Math.round(o/2),a=Math.round(n/2);this._drawBackground(t,e),MTools.paintCircle(t,new MPixel(s,a),Math.round(.36*Math.min(o,n)),!1,!0,{lineWidth:Math.round(o/10),strokeStyle:i}),t.save(),t.translate(s,a),MTools.paintLines(t,[[new MPixel(.2*-o,0),new MPixel(.2*o,0)],[new MPixel(0,.2*-n),new MPixel(0,.2*n)]],{lineCap:"round",lineWidth:Math.round(.12*o),strokeStyle:i}),t.restore()},MStandardControl.prototype._drawZoomOut=function(t,i,e){var o=t.canvas.width,n=t.canvas.height,s=Math.round(o/2),a=Math.round(n/2);this._drawBackground(t,e),MTools.paintCircle(t,new MPixel(s,a),Math.round(.36*Math.min(o,n)),!1,!0,{lineWidth:Math.round(o/10),strokeStyle:i}),t.save(),t.translate(s,a),MTools.paintLine(t,[new MPixel(.2*-o,0),new MPixel(.2*o,0)],{lineCap:"round",lineWidth:Math.round(.12*o),strokeStyle:i}),t.restore()},MStandardControl.prototype._setButtonState=function(t,i){var e,o,n="#5F6D93",s="#FFFFFF";switch(t){case 0:e=this._drawLocation,o=this._geoCtx;break;case 1:e=this._drawZoomIn,o=this._zoomInCtx;break;case 2:e=this._drawZoomOut,o=this._zoomOutCtx}switch(i){case 1:n="#FFFFFF",s="#0066CC";break;case 2:n="#CCCCCC"}MTools.clearCanvas(o),e.call(this,o,n,s)},MStandardControl.prototype._setDefaultStyle=function(){this._zoomInBtn.setCss({marginBottom:"10px"}),this._setButtonState(1,0),this._setButtonState(2,0),this._geoBtn.setCss({marginBottom:"10px"}),this._setButtonState(0,0),this._$dom.setCss({position:"absolute",width:this._btnSize,margin:0,padding:0,opacity:.8}),this._applyOptions(),this._size=this._$dom.outerSize(),this._setPosition()},MStandardControl.prototype._applyOptions=function(){var t=MElement.$$([this._zoomInBtn,this._zoomOutBtn]);this._btnLocation&&navigator.geolocation?this._geoBtn.show():this._geoBtn.hide(),this._btnZoom?t.show():t.hide()},MStandardControl.prototype._bindEvent=function(t){if(this._map){var i=t?"unbind":"bind";MTools.supportTouch()?(this._zoomInBtn[i]("touchend",this._zoomInClick,this)[i]("touchstart",this._zoomInMousedown,this),this._zoomOutBtn[i]("touchend",this._zoomOutClick,this)[i]("touchstart",this._zoomOutMousedown,this),this._geoBtn[i]("touchend",this._locationClick,this)[i]("touchstart",this._geoMousedown,this)):(this._zoomInBtn[i]("click",this._zoomInClick,this)[i]("mousedown",this._zoomInMousedown,this)[i]("mouseup",this._zoomInMouseup,this),this._zoomOutBtn[i]("click",this._zoomOutClick,this)[i]("mousedown",this._zoomOutMousedown,this)[i]("mouseup",this._zoomOutMouseup,this),this._geoBtn[i]("click",this._locationClick,this)[i]("mousedown",this._geoMousedown,this)[i]("mouseup",this._geoMouseup,this)),MEvent[i](this._map,"zoom_changed",this._mapZoomed,this),MEvent[i](this._map,"zoomRange_change",this._mapZoomRangeChanged,this),MEvent[i](this._map,"geo_start",this._mapStartLocation,this),MEvent[i](this._map,"geo_success",this._mapLocationed,this),MEvent[i](this._map,"geo_failed",this._mapLocationed,this)}},MStandardControl.prototype._zoomInMousedown=function(t){t.preventDefault(),t.stopPropagation(),!this._max&&this._setButtonState(1,1)},MStandardControl.prototype._zoomInMouseup=function(t){t.preventDefault(),t.stopPropagation()},MStandardControl.prototype._zoomOutMousedown=function(t){t.preventDefault(),t.stopPropagation(),!this._min&&this._setButtonState(2,1)},MStandardControl.prototype._zoomOutMouseup=function(t){t.preventDefault(),t.stopPropagation()},MStandardControl.prototype._geoMousedown=function(t){t.preventDefault(),t.stopPropagation(),!this._geo&&this._setButtonState(0,1)},MStandardControl.prototype._geoMouseup=function(t){t.preventDefault(),t.stopPropagation()},MStandardControl.prototype._zoomInClick=function(t){t.preventDefault(),t.stopPropagation(),this._max||(this._setButtonState(1,0),this._map.zoomIn())},MStandardControl.prototype._zoomOutClick=function(t){t.preventDefault(),t.stopPropagation(),this._min||(this._setButtonState(2,0),this._map.zoomOut())},MStandardControl.prototype._locationClick=function(t){t.preventDefault(),t.stopPropagation(),this._geo||(this._setButtonState(0,2),this._map.watchPosition(),this._geo=!0)},MStandardControl.prototype._mapStartLocation=function(t){this._setButtonState(0,2),this._geo=!0},MStandardControl.prototype._mapLocationed=function(t){this._setButtonState(0,0),this._geo=!1},MStandardControl.prototype._mapResize=function(t,i){this._setPosition(i)},MStandardControl.prototype._mapZoomed=function(t,i){this._setButton(i,this._map.getMinZoom(),this._map.getMaxZoom())},MStandardControl.prototype._mapZoomRangeChanged=function(t,i,e){this._setButton(this._map.zoom(),i,e)},MStandardControl.prototype._setButton=function(t,i,e){t>=e?(this._setButtonState(1,2),this._max=!0):(this._setButtonState(1,0),this._max=!1),t<=i?(this._setButtonState(2,2),this._min=!0):(this._setButtonState(2,0),this._min=!1)},MStandardControl.prototype._createButton=function(){var t=this._btnSize.toString();return MElement.create$("canvas").setCss({background:"none",margin:0,padding:0,cursor:"pointer"}).setAttr({width:t,height:t}).appendTo(this._$dom)},MStandardControl.prototype._setButtonSize=function(){if(MTools.browser.iphone||MTools.browser.ipad)this._btnSize=Math.round(Math.min(screen.width,screen.height)/8/(screen.width/(screen.width>=768?450:320))*MTools.getViewportScale());else{var t=Math.min(window.innerWidth,window.innerHeight),i=Math.max(window.innerWidth,window.innerHeight);this._btnSize=Math.round(t/8/(t/(i>800?450:t)))}},MStandardControl.prototype._initOptions=function(t){t=t||{},t.allowedClear=!1,MFloatPanel.prototype._initOptions.call(this,t),this._btnLocation=MTools.ifUndefined(t.btnLocation,!0),this._btnZoom=MTools.ifUndefined(t.btnZoom,!0)};var MLayer=MClass.create("MLayer",MObject);MLayer.initialize=function(t){this._tiles={},this._map=null,this._visible=!0,this._snMin=null,this._snMax=null,this._pHead=null,this._pBody=null,this._dsnMin=null,this._dsnMax=null,this._dpHead=null,this._dpBody=null,this._initOptions(t),this._initServerNum()},MLayer.prototype.map=function(){return this._map},MLayer.prototype.setMap=function(t){t instanceof MMap&&(this._map=t,this._$dom=MElement.create$("div").setCss({position:"absolute",padding:0,margin:0,zIndex:this._zIndex}),this.dom=this._$dom.get(0),this._setSize(t.size()),this._listenMapEvent(),this._loadTiles())},MLayer.prototype.visible=function(){return this._visible},MLayer.prototype.show=function(){this._visible||(this._visible=!0,this._map._renderMap())},MLayer.prototype.hide=function(){this._visible&&(this._visible=!1,this._map._renderMap())},MLayer.prototype.refresh=function(){this._clearTiles(),this._loadTiles()},MLayer.prototype.tiles=function(){return this._tiles},MLayer.prototype.zIndex=function(){return this._zIndex},MLayer.prototype.enabledTile=function(){return this._enabledTile},MLayer.prototype.remove=function(){this._clearTiles(),this._map&&(this._map._layersContainer.get(0).removeChild(this.dom),this._listenMapEvent(!1),this._map=void 0)},MLayer.prototype.setTileServer=function(t,i,e){this._tileServer=t||this._tileServer,this._tileFormat=i||this._tileFormat,this._tilePreprocessor=e||this._tilePreprocessor,this._initServerNum(),this.refresh()},MLayer.prototype.finalize=function(){this.remove(),MObject.prototype.finalize.apply(this,arguments)},MLayer.prototype._setSize=function(t){this._$dom.setCss({width:t.width+"px",height:t.height+"px"})},MLayer.prototype._loadTiles=function(){if(this._map&&this._enabledTile){var t=this._map.zoom();if(t<=this._maxZoom&&t>=this._minZoom)for(var i=this._map.grids(),e=0,o=i.length;e<o;e++)this._addTile(i[e],MGridEventAction.NORMAL)}},MLayer.prototype._clearTiles=function(){for(var t in this._tiles)this._tiles[t].finalize(),this._tiles[t]=null,delete this._tiles[t]},MLayer.prototype._listenMapEvent=function(t){t="boolean"!=typeof t||t;var i=MEvent[t?"bind":"unbind"];i(this._map,"grid_created",this._gridCreated,this),i(this._map,"grid_removed",this._gridRemoved,this),i(this._map,"grid_updated",this._updateTile,this),i(this._map,"click",this._mapClick,this),i(this._map,"resize",this._mapResize,this)},MLayer.prototype._mapResize=function(t,i){this._setSize(i)},MLayer.prototype._updateTile=function(t,i){var e=i.id(),o=this._map.zoom();o<=this._maxZoom&&o>=this._minZoom&&(this._tiles[e]?this._tiles[e].update():this._addTile(i))},MLayer.prototype._mapClick=function(t){},MLayer.prototype._gridCreated=function(t,i,e){this._enabledTile&&this._createTile(i,e),this._enabledData&&this._createData(i,e)},MLayer.prototype._gridRemoved=function(t,i){this._enabledTile&&this._removeTile(i)},MLayer.prototype._removeTile=function(t){var i=t.id(),e=this._tiles[i];e&&(e.finalize(),e=null,delete this._tiles[i])},MLayer.prototype._createTile=function(t,i){if(this._enabledTile){var e=t.zoom();e<=this._maxZoom&&e>=this._minZoom&&(this._autoLoadOfPan||i!=MGridEventAction.DRAGGING)&&this._addTile(t,i)}},MLayer.prototype._addTile=function(t,i){var e=this._buildTileUrl(t);
if(e){var o=new MImgTile(e,this,t);o._action=i,this._tiles[t.id()]=o,MEvent.bind(o,"complete",this._tileComplete,this)}},MLayer.prototype._tileComplete=function(t){var i=MElement.$(t.target.res());t.target._action===MGridEventAction.NORMAL&&(i.style.opacity=MTools.browser.firefox?1:0,i.className="mapTile",i.addEventListener("webkitAnimationEnd",function(){this.style.opacity=1},!1),i.addEventListener("animationend",function(){this.style.opacity=1},!1)),this.dom.appendChild(i)},MLayer.prototype._buildTileUrl=function(t){if(t instanceof MGrid&&this._enabledTile){if(this._tilePreprocessor)return this._tilePreprocessor.call(this._tpContext?this._tpContext:window,t);var i=MTilePathType.RELATIVE,e=t.zoom(),o=this._tileServer;if(this._pHead&&(o=this._pHead+this._getServerNumber(t)+this._pBody),i==MTilePathType.ABSOLUTE)return o+"?l="+e+"&x="+t.a_grid_x()+"&y="+t.a_grid_y();if(i==MTilePathType.RELATIVE)return this._map.isEnabledDynamicMap()?o+this._getDynamicMapUrl(t):this._map.isEnabledHighResolution()?o+this._getHighResolutionUrl(t):o+this._getLowResolutionUrl(t)}return null},MLayer.prototype._getHighResolutionUrl=function(t){var i=t.zoom(),e=this._map.isEnabledHighResolution()?i:i-1,o=Math.floor(1e5*this._map.lngStep()),n=Math.floor(1e5*this._map.latStep()),s=Math.floor(1e5*t.point().lng);s>18e6&&(s=-36e6+s);var a=Math.floor(1e5*t.point().lat),r=Math.floor(s/o),h=Math.floor(a/n);if(i>=5){var l=1e3,p=800,_=Math.floor(100*s/l/1e5),d=Math.floor(100*a/p/1e5);if(e+="/"+_+"_"+d,i>=8){l=100,p=80;var c=Math.floor(100*s/l/1e5%10),u=Math.floor(100*a/p/1e5%10);if(e+="/"+c+"_"+u,i>=11){l=10,p=8;var M=Math.floor(100*s/l/1e5%10),f=Math.floor(100*a/p/1e5%10);e+="/"+M+"_"+f}}r=Math.floor(r%(1e5*l/o/100)),h=Math.floor(h%(1e5*p/n/100))}return e+="/"+r+"_"+h,e+"."+this._tileFormat+MConfig.imgVersion},MLayer.prototype._getLowResolutionUrl=function(t){var i=t.area_x(),e=t.area_y(),o=t.r_grid_x(),n=t.r_grid_y(),s=t.zoom();return 14==s?MConfig.mapDirs[s]+"/"+i+"/"+i+"_"+e+"/"+o+"_"+n+"."+this._tileFormat+MConfig.imgVersion:MConfig.mapDirs[s]+"/"+i+"_"+e+"/"+o+"_"+n+"."+this._tileFormat+MConfig.imgVersion},MLayer.prototype._getServerNumber=function(t,i){i=isNaN(i)?0:i;var e=t.a_grid_x()%(this[i?"_dsnMax":"_snMax"]+2)-1;return e>=0?e:""},MLayer.prototype._initServerNum=function(){if(this._enabledTile){var t=this._tileServer.match(new RegExp("(.*)(\\[(\\d+)-(\\d+)\\])(.*)"));t?(this._pHead=t[1],this._pBody=t[5],this._snMin=parseInt(t[3]),this._snMax=parseInt(t[4])):(this._pHead="",this._pBody="",this._snMin="",this._snMax="")}if(this._enabledData){var i=this._dataServer.match(new RegExp("(.*)(\\[(\\d+)-(\\d+)\\])(.*)"));i?(this._dpHead=i[1],this._dpBody=i[5],this._dsnMin=parseInt(i[3]),this._dsnMax=parseInt(i[4])):(this._dpHead="",this._dpBody="",this._dsnMin="",this._dsnMax="")}},MLayer.prototype._initOptions=function(t){this._enabledTile=MTools.ifUndefined(t.enabledTile,!0),this._tileServer=t.tileServer,this._tileFormat=MTools.ifUndefined(t.tileFormat,"png"),this._autoLoadOfPan=MTools.ifUndefined(t.autoLoadOfPan,!0),this._enabledData=MTools.ifUndefined(t.enabledData,!1),this._dataServer=t.dataServer,this._dataFormat=MTools.ifUndefined(t.dataFormat,"js"),this._dataCallbackName=MTools.ifUndefined(t.dataCallbackName,"getPoiData"),this._zIndex=MTools.ifUndefined(t.zIndex,21),this._maxZoom=MTools.ifUndefined(t.maxZoom,MConfig.maxZoom),this._maxZoom=MTools.between(this._maxZoom,MConfig.minZoom,MConfig.maxZoom,MConfig.maxZoom),this._minZoom=MTools.ifUndefined(t.minZoom,MConfig.minZoom),this._minZoom=MTools.between(this._minZoom,MConfig.minZoom,this._maxZoom,MConfig.minZoom),this._allowedClear=this._allowedClear=MTools.ifUndefined(t.allowedClear,!0),this._tilePreprocessor=t.tilePreprocessor,this._tpContext=t.tpContext,this._dataPreprocessor=t.dataPreprocessor,this._dpContext=t.dpContext},MLayer.prototype._getDynamicMapUrl=function(t){var i=t.a_grid_x(),e=t.a_grid_y(),o=t.zoom();return MConfig.mapDirs[o]+"/"+i+"/"+e+"/?_="+MConfig.imgVersion};var MTraffic=MClass.create("MTraffic",MLayer);MTraffic.initialize=function(t){t=MTools.ifUndefined(t,{}),MLayer.initialize.call(this,t),this._timer=null,this._interval=300,this.setInterval(t.interval)},MTraffic.prototype._autoRefresh=function(){this.refresh()},MTraffic.prototype._resetTimer=function(){this._timer&&window.clearInterval(this._timer),this._timer=MTools.interval(this,this._autoRefresh,1e3*this._interval)},MTraffic.prototype.setMap=function(t){MLayer.prototype.setMap.apply(this,arguments),this.setMinZoom(this._minZoom),this.setMaxZoom(this._maxZoom),this._resetTimer()},MTraffic.prototype.setMinZoom=function(t){t=MTools.ifTypeOf(t,"number",this._minZoom),t=MTools.between(t,this._map._trafficMinZoom,map._trafficMaxZoom,this._map._trafficMinZoom),this._minZoom!=t&&(this._minZoom=t,this.refresh())},MTraffic.prototype.setMaxZoom=function(t){t=MTools.ifTypeOf(t,"number",this._maxZoom),t=MTools.between(t,this._map._trafficMinZoom,this._map._trafficMaxZoom,this._map._trafficMaxZoom),this._maxZoom!=t&&(this._maxZoom=t,this.refresh())},MTraffic.prototype.interval=function(){return this._interval},MTraffic.prototype.setInterval=function(t){this._interval=MTools.ifUndefined(t,this._interval),this._interval=MTools.between(this._interval,60,Number.MAX_VALUE,this._interval),this._resetTimer()},MTraffic.prototype.finalize=function(){this._timer&&window.clearInterval(this._timer),this._timer=null,MLayer.prototype.finalize.apply(this,arguments)},MTraffic.prototype._getDynamicMapUrl=function(t){var i=t.a_grid_x(),e=t.a_grid_y(),o=t.zoom();return"z="+MConfig.mapDirs[o]+"&x="+i+"&y="+e+"&_="+MConfig.imgVersion};var MConfig={mapDirs:["W","0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15"],lngSteps:[90,40,20,10,5,2,1,.5,.2,.1,.05,.02,.01,.005,.002,.001],latSteps:[72,32,16,8,4,1.6,.8,.4,.2*.8,.1*.8,.05*.8,.016,.008,.004,.0016,8e-4],gridFactors:[10,10,10,10,10,10,10,10,10,10,50,50,50,50,50],standardSafe:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],lonRange:[],latRange:[],gridWidth:300,gridHeight:300,keyOfCODE13:"",keyOfCODE14:"",minLevelGroup:0,maxLevelGroup:3,trafficMinZoom:8,minZoom:0,maxZoom:14,copyright:'<span style="font-size:14px;text-shadow:1px 1px 1px #fff;white-space:nowrap;overflow:hidden;">&copy&nbsp;2014&nbsp;Mapbar&nbsp;-&nbsp;GS(2013)6018</span>',isUseImgVersion:!0,imgVersion:""},MDynamicConfig={mapDirs:["0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20"],lngSteps:[],latSteps:[],gridWidth:256,gridHeight:256,trafficMinZoom:10,minZoom:0,maxZoom:18};MDynamicConfig.mapDirs.forEach(function(t,i){var e;e=i?MDynamicConfig.lngSteps[i-1]/2:360,MDynamicConfig.lngSteps[i]=e,MDynamicConfig.latSteps[i]=e/2}),function(){if(MConfig=MConfig||{},void 0!=typeof MConfig.isUseImgVersion&&MConfig.isUseImgVersion){var t=new Date,i=t.getMonth()+1,e="?",o=i<10?"0"+i:i,n=t.getDate();MConfig.imgVersion=e+o+n,MConfig.ivcb=function(t){MConfig.imgVersion=e+t};var s="mapbar.mobilePlugin.js",a="mImgVerScript",r="<script id='"+a+"' src='"+s+"'></script>";document.write(r);var h=document.getElementById(a);h.onload=function(){this.parentNode.removeChild(h)},h.onerror=function(){this.parentNode.removeChild(h)}}}();var MPoint=MClass.create("MPoint",MObject);MPoint.initialize=function(t,i,e){this.lat="number"==typeof i?Math.round(1e6*i)/1e6:null,this.lng="number"==typeof t?Math.round(1e6*t)/1e6:null,this.levelGroup=MConfig.maxLevelGroup,"number"==typeof e&&e>=MConfig.minLevelGroup&&e<=MConfig.maxLevelGroup&&(this.levelGroup=e)},MPoint.prototype.clone=function(){return new MPoint(this.lng,this.lat,this.levelGroup)},MPoint.prototype.equals=function(t){return t instanceof MPoint&&this.lat===t.lat&&this.lng===t.lng},MPoint.prototype.equalsAll=function(t){return this.equals(t)&&this.levelGroup===t.levelGroup},MPoint.prototype.toString=function(){return"MPoint: {"+this.lng+","+this.lat+"}"};var MTile=MClass.create("MTile",MObject);MTile.initialize=function(t,i,e){this._url="string"==typeof t?t:null,this._layer=i instanceof MLayer?i:null,this._grid=e instanceof MGrid?e:null,this._ready=!1},MTile.prototype.ready=function(){return this._ready},MTile.prototype.res=function(){return this._res},MTile.prototype.url=function(){return this._url},MTile.prototype.grid=function(){return this._grid},MTile.prototype.layer=function(){return this._layer},MTile.prototype.update=function(){},MTile.prototype.start=function(){},MTile.prototype.finalize=function(){MObject.prototype.finalize.apply(this)};var MImgTile=MClass.create("MImgTile",MTile);MImgTile.initialize=function(t,i,e){MTile.initialize.call(this,t,i,e),this._rTimes=0,this._fTimes=3,this._res=MElement.create$("img").setCss({position:"absolute",border:"none",margin:0,padding:0}).bind("load",this._load,this).bind("error",this._error,this).setAttr("src",this._url).get(0)},MImgTile.prototype.finalize=function(){this._res.src="",MEvent.unbind(this._res),MTools.removeNode(this._res),MTile.prototype.finalize.apply(this)},MImgTile.prototype.update=function(){var t=this._layer.map();t.isEnabledDynamicMap()?this.updateDynamic(t):this.updateDefault(t)},MImgTile.prototype.updateDefault=function(t){if(this._grid){var i=this._grid.bounds(),e=t.toPixel(new MPoint(i.min.lng,i.max.lat));MElement.$$(this._res).setCss({width:MConfig.gridWidth+"px",height:MConfig.gridHeight+"px",top:e.y+"px",left:e.x+"px"})}},MImgTile.prototype.start=function(){this._res.src=this._url},MImgTile.prototype._load=function(){this._ready=!0,this.update(),MEvent.trigger(this,"complete")},MImgTile.prototype._error=function(){this._rTimes<this._fTimes?(this._rTimes++,this._res.src=this._url):(this._ready=!0,MEvent.trigger(this,"failed"))},MImgTile.prototype.updateDynamic=function(t){if(this._grid){var i=this._grid.bounds(),e=t.toPixel(new MPoint(i.min.lng,i.max.lat));MElement.$$(this._res).setCss({width:MConfig.gridWidth+"px",height:MConfig.gridHeight+"px",top:e.y+"px",left:e.x+"px"})}};var MGrid=MClass.create("MGrid",MObject);MGrid.initialize=function(t,i){this._point=MClass.chkObj(t,MPoint),this._map=MClass.chkObj(i,MMap),this._zoom=this._map?this._map.zoom():null,this._tiles=[],this._bounds=null,this._areaX=null,this._areaY=null,this._rGridX=null,this._rGridY=null,this._id=null,this._dataX=null,this._dataY=null,this._point&&this._map?(this._x=Math.floor(parseFloat(this._point.lng)/MMap.lngStep(this._zoom)),this._y=Math.floor(parseFloat(this._point.lat)/MMap.latStep(this._zoom))):(this._x=null,this._y=null)},MGrid.prototype.point=function(){return this._point},MGrid.prototype.bounds=function(){if(!this._bounds){if("number"==typeof this._zoom){var t=MConfig.lngSteps[this._zoom],i=MConfig.latSteps[this._zoom],e=this._x,o=this._y;return this._bounds=new MBounds(new MPoint(e*t,o*i),new MPoint((e+1)*t,(o+1)*i))}return null}return this._bounds},MGrid.prototype.id=function(){return this._id||(this._id=this._zoom.toString(16)+this._x.toString(16)+"l"+this._y.toString(16).toLowerCase()),this._id},MGrid.prototype.area_x=function(){if("number"!=typeof this._areaX){if("number"==typeof this._zoom){var t=this._x,i=MMap.gridTCountOfLon(this._zoom);return t%=i,t>=i/2&&(t-=i),t<-i/2&&(t+=i),this._areaX=parseInt(Math.floor(t/MConfig.gridFactors[this._zoom])),this._areaX<0&&(this._areaX=0),this._areaX}return null}return this._areaX},MGrid.prototype.area_y=function(){return"number"!=typeof this._areaY?"number"==typeof this._zoom?(this._areaY=parseInt(Math.floor(this._y/MConfig.gridFactors[this._zoom])),this._areaY):null:this._areaY},MGrid.prototype.r_grid_x=function(){if("number"!=typeof this._rGridX){if("number"==typeof this._zoom){var t=this._x,i=MMap.gridTCountOfLon(this._zoom);return t%=i,t>=i/2&&(t-=i),t<-i/2&&(t+=i),this._rGridX=t-this.area_x()*MConfig.gridFactors[this._zoom],this._rGridX}return null}return this._rGridX},MGrid.prototype.r_grid_y=function(){return"number"!=typeof this._rGridY?"number"==typeof this._zoom?(this._rGridY=this._y-this.area_y()*MConfig.gridFactors[this._zoom],this._rGridY):null:this._rGridY},MGrid.prototype.a_grid_x=function(){return this._x},MGrid.prototype.a_grid_y=function(){return this._y},MGrid.prototype.zoom=function(){return"number"==typeof this._zoom?this._zoom:null},MGrid.prototype.addTile=function(t){t instanceof MTile&&this._tiles.push(t)},MGrid.prototype.tiles=function(){return this._tiles},MGrid.prototype.equals=function(t){return t instanceof MGrid&&t.zoom()===this._zoom&&t.a_grid_x()===this._x&&t.a_grid_y()===this._y},MGrid.prototype.setZoom=function(t){"number"==typeof t&&(this._zoom=t,this._bounds=null,this._areaX=null,this._areaY=null,this._rGridX=null,this._rGridY=null,this._id=null,this._x=Math.floor(parseFloat(this._point.lng)/MConfig.lngSteps[t]),this._y=Math.floor(parseFloat(this._point.lat)/MConfig.latSteps[t]))},MGrid.prototype.finalize=function(){MObject.prototype.finalize.apply(this)};var MDynamicGrid=MClass.create("MDynamicGrid",MGrid);MDynamicGrid.initialize=function(t,i){if(this._point=MClass.chkObj(t,MPoint),this._map=MClass.chkObj(i,MMap),this._zoom=this._map?this._map.zoom():null,this._tiles=[],this._bounds=null,this._areaX=null,this._areaY=null,this._rGridX=null,this._rGridY=null,this._id=null,this._dataX=null,this._dataY=null,this._point&&this._map){var e=MMap.LatLonToPixels(this._point.lng,this._point.lat,this._zoom);this._x=Math.floor(e.x/MConfig.gridWidth),this._y=Math.floor(e.y/MConfig.gridHeight)}else this._x=null,this._y=null},MDynamicGrid.prototype.point=function(){return this._point},MDynamicGrid.prototype.bounds=function(){if(!this._bounds){if("number"==typeof this._zoom){var t=this._point,i=this._x,e=this._y,o=this._zoom,n=MMap.PixelsToLatLon((i+1)*MConfig.gridWidth,(e+1)*MConfig.gridHeight,o);return this._bounds=new MBounds(new MPoint(t.lng,n.lat),new MPoint(n.lng,t.lat))}return null}return this._bounds},MDynamicGrid.prototype.id=function(){return this._id||(this._id=this._zoom.toString(16)+this._x.toString(16)+"l"+this._y.toString(16).toLowerCase()),this._id},MDynamicGrid.prototype.area_x=function(){if("number"!=typeof this._areaX){if("number"==typeof this._zoom){var t=this._x,i=MMap.gridTCountOfLon(this._zoom);return t%=i,t>=i/2&&(t-=i),t<-i/2&&(t+=i),this._areaX=parseInt(Math.floor(t/MConfig.gridFactors[this._zoom])),this._areaX<0&&(this._areaX=0),this._areaX}return null}return this._areaX},MDynamicGrid.prototype.area_y=function(){return"number"!=typeof this._areaY?"number"==typeof this._zoom?(this._areaY=parseInt(Math.floor(this._y/MConfig.gridFactors[this._zoom])),this._areaY):null:this._areaY},MDynamicGrid.prototype.r_grid_x=function(){if("number"!=typeof this._rGridX){if("number"==typeof this._zoom){var t=this._x,i=MMap.gridTCountOfLon(this._zoom);return t%=i,t>=i/2&&(t-=i),t<-i/2&&(t+=i),this._rGridX=t-this.area_x()*MConfig.gridFactors[this._zoom],this._rGridX}return null}return this._rGridX},MDynamicGrid.prototype.r_grid_y=function(){return"number"!=typeof this._rGridY?"number"==typeof this._zoom?(this._rGridY=this._y-this.area_y()*MConfig.gridFactors[this._zoom],this._rGridY):null:this._rGridY},MDynamicGrid.prototype.a_grid_x=function(){return this._x},MDynamicGrid.prototype.a_grid_y=function(){return this._y},MDynamicGrid.prototype.zoom=function(){return"number"==typeof this._zoom?this._zoom:null},MDynamicGrid.prototype.addTile=function(t){t instanceof MTile&&this._tiles.push(t)},MDynamicGrid.prototype.tiles=function(){return this._tiles},MDynamicGrid.prototype.equals=function(t){return t instanceof MDynamicGrid&&t.zoom()===this._zoom&&t.a_grid_x()===this._x&&t.a_grid_y()===this._y},MDynamicGrid.prototype.setZoom=function(t){"number"==typeof t&&(this._zoom=t,this._bounds=null,this._areaX=null,this._areaY=null,this._rGridX=null,this._rGridY=null,this._id=null,this._x=Math.floor(parseFloat(this._point.lng)/MConfig.lngSteps[t]),this._y=Math.floor(parseFloat(this._point.lat)/MConfig.latSteps[t]))},MDynamicGrid.prototype.finalize=function(){MObject.prototype.finalize.apply(this)};var MMap=MClass.create("MMap",MObject);MMap.initialize=function(t,i){MMap.addStyle||(MElement.create$("style").setAttr("type","text/css").html(MMap.strStyle).appendTo(document.head),MMap.addStyle=!0),this.dom=void 0,this._$dom=void 0,this._mapContainer=void 0,this._mapBackground=void 0,this._size=void 0,this._mapLayer=void 0,this._layersContainer=void 0,this._markerContainer=void 0,this._handleContainer=void 0,this._iwContainer=void 0,this._shadowContainer=void 0,this._canvasContainer=void 0,this._overlays={},this._traffic=void 0,this._infoWindows={},this._panels={},this._geoMarker=void 0,this._geoRange=void 0,this._geoPoint=void 0,this._geoAccuracy=void 0,this._gettingPosition=0,this._geoData=void 0,this._mousex=0,this._mousey=0,this._downx=0,this._downy=0,this._upx=0,this._upy=0,this._dragPixel=[null,null,null],this._dragedPixel=null,this._interval=void 0,this._gridComplete=!1,this._zoomChange=!1,this._timerRun=!1,this._touchstartTime=void 0,this._touchTimer=void 0,this._draged=!1,this._wpid=void 0,this._dragTime=[],this._dragPositions=[],this._dragAnime=void 0,this._panAnime=void 0,this._dragScrolling=!1,this._touchPixel=void 0,this._supportGestureEvent=!0,this._startedGesture=!1,this._gesturing=!1,this._justGesture=!1,this._scaleNote={start:null,pixel:[null,null],scale:[null,null]},this._scaleZoomed=!1,this._zoomedCenter=void 0,this._zoomedLevel=void 0,this._zooming=!1,this._initZoom=void 0,this._initCenter=void 0,this._offset=0,this._scaleX=void 0,this._scaleY=void 0,this._maxCol=void 0,this._minCol=void 0,this._maxRow=void 0,this._minRow=void 0,this._ctrX=void 0,this._ctrY=void 0,this._layers=[],this._layerArray=[],this._center=null,this._zoom=null,this._grids={},this._mode=MMapMode.PAN,this._startedDrag=!1,this._dragging=!1,this._markerMaxZIndex=0,this._canvasMaxZIndex=0,this._pinPanelMaxZIndex=0,this._floatPanelMaxZIndex=0,this._bgScale=4,this._vectors={},this._initOptions(i),this._$dom=MElement.$$(t),this.dom=this._$dom.get(0),MElement.isElement(this.dom,"div")&&(this._initHighResolution(),this._initStruct(),this._setDefaultStyle(),this._bindEvent(),this._updateData(),this._startBuildGrids(),this._addCopyright(),this._standardControl&&MTools.timeout(this,this._addStandardControl,200))},MMap.decodeLine=function(t,i){var e=[];if("string"!=typeof t||!t||"string"!=typeof i||!i||i.indexOf(",")===-1)return e;for(var o=MMap.decodePts(t),n=MMap.decodeLevels(i),s=0,a=o.length;s<a;s++)e.push(new MPoint(1e-5*o[s][1],1e-5*o[s][0],MTools.ifUndefined(n[s],0)));return e},MMap.decodePts=function(t){var i=[];if("string"==typeof t&&t){var e=MTools.decodeNumberEx(t),o=e[0],n=e[1];i.push([o,n]);for(var s=2,a=e.length;s<a;s+=2)o+=e[s],n+=e[s+1],i.push([o,n])}return i},MMap.decodeLevels=function(t){var i={};if("string"==typeof t&&t&&t.indexOf(",")!==-1)for(var e=t.split(","),o=0,n=e.length;o<n;o++)for(var s=MTools.decodeNumberEx(e[o]),a=0,r=0,h=s.length;r<h;r++)a+=s[r],i[a]=o+1;return i},MMap.prototype.setMaxZoom=function(t){this._setMaxZoom(t)},MMap.prototype.setMinZoom=function(t){this._setMinZoom(t)},MMap.prototype.setZoomRange=function(t,i){var e=this.zoom();t<=i&&(this._setMinZoom(t,!0,!0,!0),this._setMaxZoom(i,!0,!0,!0),e>this._maxZoom?this.setZoom(this._maxZoom):e<this._minZoom&&this.setZoom(this._minZoom)),MEvent.trigger(this,"zoomRange_change",this._minZoom,this._maxZoom)},MMap.prototype.getMinZoom=function(){return this._minZoom},MMap.prototype.getMaxZoom=function(){return this._maxZoom},MMap.prototype.getZoomRange=function(){return{minZoom:this._minZoom,maxZoom:this._maxZoom}},MMap.prototype.isEnabledDragging=function(){return!this._disableDragging},MMap.prototype.enableDragging=function(){this._disableDragging=!1},MMap.prototype.disableDragging=function(){this._disableDragging=!0},MMap.prototype.isEnabledDoubleClickZoom=function(){return!this._disableDoubleClickZoom},MMap.prototype.enableDoubleClickZoom=function(){this._disableDoubleClickZoom=!1},MMap.prototype.disableDoubleClickZoom=function(){this._disableDoubleClickZoom=!0},MMap.prototype.isEnabledInertialDragging=function(){return!this._disableIntertialDragging},MMap.prototype.enableIntertialDragging=function(){this._disableIntertialDragging=!1},MMap.prototype.disableIntertialDragging=function(){this._disableIntertialDragging=!0},MMap.prototype.enablePinchToZoom=function(){this._disablePinchToZoom=!1},MMap.prototype.disablePinchToZoom=function(){this._disablePinchToZoom=!0},MMap.prototype.resourceUrl=function(){return this._resourceUrl},MMap.prototype.setResourceUrl=function(t){this._resourceUrl=MTools.ifUndefined(t,"http://img.mapbar.com/maplite/images/")},MMap.prototype.defaultImgIconUrl=function(){return this._defaultImgIconUrl},MMap.prototype.setDefaultImgIconUrl=function(t){this._defaultImgIconUrl=t},MMap.prototype.isEnabledGeolocation=function(){return this._enabledGeolocation},MMap.prototype.enableGeolocation=function(){this._enabledGeolocation=!0},MMap.prototype.disableGeolocation=function(){this._enabledGeolocation=!1},MMap.prototype.isEnabledHighResolution=function(){return this._enabledHighResolution},MMap.prototype.center=function(){return this._center instanceof MPoint?this._center.clone():null},MMap.prototype.zoom=function(){return this._zoom},MMap.prototype.grids=function(){var t=[];for(var i in this._grids)t.push(this._grids[i]);return t},MMap.prototype.bounds=function(){return this._getBounds()},MMap.prototype.distance=function(t){var i=0,e=t instanceof Array?t.length:0;if(e<2)return i;for(var o=1;o<e;o++){var n=t[o-1],s=t[o],a=Math.round(1e6*s.lat-1e6*n.lat)/1e6,r=Math.round(1e6*s.lng-1e6*n.lng)/1e6;i+=Math.sqrt(a*a+r*r*.46)}return parseInt(111111*i)},MMap.prototype.size=function(){return this._size||(this._size=this._$dom.innerSize(!1)),this._size},MMap.prototype.setCenter=function(t){this._centerAndZoom(t,this._zoom)},MMap.prototype.setZoom=function(t){"number"==typeof t&&t>=this._minZoom&&t<=this._maxZoom&&this._zoom!==t&&this._centerAndZoom(this._center,t,arguments[1])},MMap.prototype.centerAndZoom=function(t,i){this._centerAndZoom(t,i)},MMap.prototype.resize=function(t){this._redrawMap(null,null,t)},MMap.prototype.zoomIn=function(){var t=this._zoom;t+=t<this._maxZoom?1:0,this.setZoom(t)},MMap.prototype.zoomOut=function(){var t=this._zoom;t-=t>this._minZoom?1:0,this.setZoom(t)},MMap.prototype.reset=function(){this._centerAndZoom(this._initCenter,this._initZoom)},MMap.prototype.intoView=function(t){if(MClass.classOf(t,MBounds)){var i,e,o=this._getBounds(),n=o.max.lng-o.min.lng,s=o.max.lat-o.min.lat,a=t.max.lng-t.min.lng,r=t.max.lat-t.min.lat;if(a>n||r>s){for(var h=this._zoom-1;h>=this._minZoom;h--)if(o=this._getBounds(this._center,h),n=o.max.lng-o.min.lng,s=o.max.lat-o.min.lat,a<n&&r<s){i=h;break}"undefined"==typeof i&&(i=this._zoom),e=t.mid()}else t.equals(o.intersects(t))||(i=this._zoom,e=t.mid());e&&i&&this.centerAndZoom(e,i)}},MMap.prototype.overlaysBounds=function(t){if(!t.length)return null;for(var i=null,e=0,o=t.length;e<o;e++){var n=t[e],s=n.bounds();s&&(e?(i["extends"](s.min),i["extends"](s.max)):i=s)}return i},MMap.prototype.setViewport=function(t){if(t instanceof MBounds){for(var i=t.mid(),e=this.getMaxZoom(),o=this._getBounds(i,e);!o.containsRange(t)&&e>this._minZoom;)o=this._getBounds(i,--e);e=e<=this._minZoom?this._minZoom:--e,this._centerAndZoom(i,e)}},MMap.prototype.panTo=function(t,i){i=i||{},i.noAnimation=MTools.ifUndefined(i.noAnimation,!1),this._centerAndZoom(t,this._zoom,!i.noAnimation)},MMap.prototype.panBy=function(t,i,e){e=e||{},e.noAnimation=MTools.ifUndefined(e.noAnimation,!1),t=MTools.ifTypeOf(t,"number",0),i=MTools.ifTypeOf(i,"number",0),this._centerAndZoom(this.toPoint(this._ctrX-t,this._ctrY-i),this._zoom,!e.noAnimation)},MMap.prototype.toPixel=function(t,i){var e;if(t instanceof MPoint)e=t.clone();else{if("number"!=typeof t||"number"!=typeof i)return null;e=new MPoint(t,i)}return this._getPixel(e)},MMap.prototype.toPoint=function(t,i){var e;if(t instanceof MPixel)e=t.clone();else{if("number"!=typeof t||"number"!=typeof i)return null;e=new MPixel(t,i)}return this._getPoint(e)},MMap.prototype.checkLevelGroup=function(t){return this._zoom>=0&&this._zoom<=3&&3===t.levelGroup||this._zoom>=4&&this._zoom<=7&&t.levelGroup>=2||this._zoom>=8&&this._zoom<=11&&t.levelGroup>=1||this._zoom>=12&&this._zoom<=18&&t.levelGroup>=0},MMap.prototype.lngStep=function(){return MMap.lngStep("number"==typeof arguments[0]?arguments[0]:this._zoom)},MMap.prototype.latStep=function(){return MMap.latStep("number"==typeof arguments[0]?arguments[0]:this._zoom)},MMap.prototype.gridFactor=function(){return MConfig.gridFactors[this.zoom()]},MMap.prototype.layers=function(){return this._layers.concat()},MMap.prototype.addLayer=function(t){t instanceof MLayer&&(t.setMap(this),this._layersContainer.append(t.dom),this._layers.push(t))},MMap.prototype.removeLayer=function(t){for(var i,e,o=0,n=this._layers.length;o<n&&(i=this._layers[o],e=o,i!==t);o++);this._layers.splice(e,1),i.finalize()},MMap.prototype.clearLayer=function(){for(var t,i=0,e=this._layers.length;i<e;i++)t=this._layers[i],t._allowedClear&&this.removeLayer(t)},MMap.prototype.enableTraffic=function(t){this._traffic||(t=MTools.ifUndefined(t,{allowedClear:!1}),t.tileServer=this._trafficImgServer,t.zIndex=MSysLayerZIndex.TRAFFIC_LAYER,this._traffic=new MTraffic(t),this.addLayer(this._traffic))},MMap.prototype.disableTraffic=function(){this._traffic instanceof MTraffic&&(this.removeLayer(this._traffic),this._traffic=null)},MMap.prototype.setMapImageServer=function(t,i,e){this._mapBackground.setCss3({transition:"",transform:"scale(1) translate(0px, 0px)"}).html(this._mapImgLayer.html()),this._mapLayer.setTileServer(t,i,e)},MMap.prototype.overlays=function(){var t=[];for(var i in this._overlays)t.push(this._overlays[i]);return t},MMap.prototype.addOverlay=function(t){this._addOverlay(t)},MMap.prototype.removeOverlay=function(t,i,e){if(t instanceof MOverlay&&t.allowedClear()){i=MTools.ifTypeOf(i,"boolean",!0);var o=t.id();e||(i?t.finalize():t.remove()),delete this._overlays[o],delete this._vectors[o]}},MMap.prototype.clearOverlay=function(t){t=MTools.ifTypeOf(t,"boolean",!0);for(var i in this._overlays)this._overlays.hasOwnProperty(i)&&this.removeOverlay(this._overlays[i],t)},MMap.prototype.addPanel=function(t){t instanceof MPanel&&(t.setMap(this),this._panels[t.id()]=t)},MMap.prototype.removePanel=function(t,i){if(i=MTools.ifTypeOf(i,"boolean",!0),t instanceof MPanel){var e=t.id();i?t.finalize():t.remove(),delete this._panels[e]}},MMap.prototype.clearPanel=function(t){t=MTools.ifTypeOf(t,"boolean",!0);for(var i in this._panels)if(this._panels.hasOwnProperty(i)){var e=this._panels[i];e.allowedClear()&&this.removePanel(e,t)}},MMap.prototype.addInfoWindow=function(t){t instanceof MInfoWindowView&&(this._allowMultiInfoWindow||this.closeInfoWindow(),this._infoWindows[t.id()]=t,this._iwContainer.append(t.dom()))},MMap.prototype.openInfoWindow=function(t,i){var e=this.toPixel(t);e&&i instanceof MInfoWindowView&&(i.setMap(this),i.open(e))},MMap.prototype.closeInfoWindow=function(t){var i,e;if(t instanceof MInfoWindowView)e=t.id(),i=this._infoWindows[e],i.owner()||delete this._infoWindows[e],i.close();else if("undefined"==typeof t)for(var o in this._infoWindows)i=this._infoWindows[o],i.owner()||delete this._infoWindows[o],i.close()},MMap.prototype.removeInfoWindow=function(t){if(t instanceof MInfoWindowView){var i=t.id();t.remove(),delete this._infoWindows[i]}},MMap.prototype.nextMarkerZIndex=function(){return++this._markerMaxZIndex},MMap.prototype.nextCanvasZIndex=function(){return++this._canvasMaxZIndex},MMap.prototype._nextPinPanelZIndex=function(){return++this._pinPanelMaxZIndex},MMap.prototype._nextFloatPanelZIndex=function(){return++this._floatPanelMaxZIndex},MMap.prototype.mode=function(){return this._mode},MMap.prototype.enablePanMode=function(){this._mode=MMapMode.PAN},MMap.prototype.enableMarkerMode=function(t){},MMap.prototype.getCurrentPosition=function(t,i){if(this._enabledGeolocation&&!this._gettingPosition){if("function"!=typeof this._getPositionAgent){if(!navigator.geolocation)return!1;this._geoData=MTools.extend(i),this._gettingPosition=0,this._startLocation("getCurrentPosition",t)}else this._geoData=MTools.extend(i),this._gettingPosition=0,this._getPositionAgent();return this._triggerGeoStartEvent(this._geoData),!0}return!1},MMap.prototype.watchPosition=function(t,i){if(this._enabledGeolocation&&!this._gettingPosition){if("function"!=typeof this._watchPositionAgent){if(!navigator.geolocation&&void 0==this._wpid)return!1;this._geoData=MTools.extend(i),this._gettingPosition=2,this._wpid=this._startLocation("watchPosition",t)}else this._geoData=MTools.extend(i),this._gettingPosition=2,this._watchPositionAgent();return this._triggerGeoStartEvent(this._geoData),!0}return!1},MMap.prototype.stopWatchPosition=function(){if(this._enabledGeolocation){if("function"!=typeof this._stopWatchPositionAgent){if(void 0==this._wpid||!navigator.geolocation)return;navigator.geolocation.clearWatch(this._wpid),this._wpid=void 0}else this._stopWatchPositionAgent();this._gettingPosition=0,MEvent.trigger(this,"watchposition_stop",this._geoData)}},MMap.prototype.geoSuccess=function(t){t=t||{},1===this._gettingPosition&&(this._gettingPosition=0),MEvent.trigger(this,"geo_success",t,this._geoData)},MMap.prototype.geoFailed=function(t){t=t||{},1===this._gettingPosition&&(this._gettingPosition=0),MEvent.trigger(this,"geo_failed",t,this._geoData)},MMap.prototype.finalize=function(){for(var t in this._overlays)this._overlays.hasOwnProperty(t)&&this._overlays[t].finalize(),this._overlays[t]=null,delete this._overlays[t];this._geoMarker&&this._geoMarker.finalize();for(var i=0,e=this._panels.length;i<e;i++)this._panels[i].finalize();this._panels.length=0,MEvent.unbind(this.dom),this._dragAnime||MEvent.unbind(this._dragAnime),MEvent.unbind(window,"unload",this.finalize),this._clearGrid();for(var o=0,n=this._layers.length;o<n;o++)this._layers[o].finalize();this._layers.length=0,MElement.$$([this._panelContainer,this._mapContainer]).remove(),MObject.prototype.finalize.apply(this,arguments)},MMap.prototype._renderBackground=function(t){if("string"==typeof t&&this._mapBackground._grids[t]instanceof MGrid){var i=this._mapBackground._grids[t],e=this._zoom-this._bgScale<0?0:this._zoom-this._bgScale,o=i.bounds(),n=MMap.pixelDistance(this._center,new MPoint(o.min.lng,o.max.lat),e),s=MMap.lngStep(e)/MMap.lngStep(this._zoom),a=this._mapBackground._tiles[t],r=300*s*2,h=(this._size.width-r)/2,l=(this._size.height-r)/2;a.ready()&&(this._mapBgContext.drawImage(a.res(),n.x/2,n.y/2,150,150),this._mapBgCanvas.setCss({width:r+"px",height:r+"px",top:l+"px",left:h+"px"}))}else if("undefined"==typeof t)for(var p in this._mapBackground._grids)arguments.callee(p)},MMap.prototype._renderMap=function(t){if("string"==typeof t){var i,e,o,n,s,a=this._grids[t];if(a instanceof MGrid){i=a.bounds(),e=this.toPixel(new MPoint(i.min.lng,i.max.lat)),o=this._mapLayer.tiles()[t],o instanceof MTile&&o.ready()&&this._drawMapImage(o.res(),e);for(var r=0,h=this._layerArray.length;r<h;r++)if(n=this._layerArray[r],n instanceof Array)for(var l=0,p=n.length;l<p;l++)s=n[l],s instanceof MLayer&&(o=s.tiles()[t],o instanceof MTile&&o.ready()&&this._drawMapImage(o.res(),e))}}else for(var _ in this._grids)arguments.callee.call(this,_)},MMap.prototype._drawMapImage=function(t,i){this._dragging?this._loadContext.drawImage(t,i.x,i.y):this._mapContext.drawImage(t,i.x,i.y)},MMap.prototype._initHighResolution=function(){if(!this.isEnabledDynamicMap()&&this.isEnabledHighResolution())for(var t=0,i=MConfig.lngSteps.length;t<i;t++)MConfig.lngSteps[t]=MConfig.lngSteps[t]/2,MConfig.latSteps[t]=MConfig.latSteps[t]/2},MMap.prototype._initStruct=function(){this.size(),this._mapContainer=MElement.create$("div").setAttr("id","mapContainer").appendTo(this._$dom),this._setContainerStyle(this._mapContainer,{zIndex:MSysLayerZIndex.MAP_CONTAINER}),this._mapBackground=MElement.create$("div").setAttr("id","mapBackground").appendTo(this._mapContainer),this._setContainerStyle(this._mapBackground,{zIndex:MSysLayerZIndex.MAP_BACKGROUND}),this._mapLayer=new MLayer({tileServer:this._mapImgServer,tileFormat:this._mapImgFormat,
zIndex:MSysLayerZIndex.MAP_LAYER,maxZoom:this._maxZoom,minZoom:this._minZoom,allowedClear:!1,autoLoadOfPan:this._autoLoadOfPan}),this._mapLayer.setMap(this),this._mapContainer.append(this._mapLayer.dom),this._mapImgLayer=MElement.$$(this._mapLayer.dom).setCss3({"transform-origin":"",transition:"",transform:"scale(1)"}),this._layersContainer=MElement.create$("div").setAttr("id","layersContainer").appendTo(this._mapContainer),this._setContainerStyle(this._layersContainer,{width:0,height:0,zIndex:MSysLayerZIndex.LAYERS_CONTAINER}),this._canvasContainer=MElement.create$("div").setAttr({id:"canvasContainer",width:this._size.width,height:this._size.height}).appendTo(this._mapContainer),this._setContainerStyle(this._canvasContainer,{width:0,height:0,zIndex:MSysLayerZIndex.SVG_CONTAINER}),MTools.supportSVG&&(this._svgContainer=MElement.createSVG$("svg").setAttr({version:"1.1",overflow:"visible",viewBox:[-this._size.width,-this._size.height,3*this._size.width,3*this._size.height].join(" "),height:3*this._size.height,width:3*this._size.width}).setCss({position:"absolute",top:-this._size.height+"px",left:-this._size.width+"px"}).appendTo(this._canvasContainer)),this._shadowContainer=MElement.create$("div").setAttr("id","shadowContainer").appendTo(this._mapContainer),this._setContainerStyle(this._shadowContainer,{zIndex:MSysLayerZIndex.SHADOW_CONTAINER,width:0,height:0}),this._markerContainer=MElement.create$("div").setAttr("id","markerContainer").appendTo(this._mapContainer),this._setContainerStyle(this._markerContainer,{zIndex:MSysLayerZIndex.MARKER_CONTAINER,width:0,height:0}),this._handleContainer=MElement.create$("div").setAttr("id","handleContainer").appendTo(this._mapContainer),this._setContainerStyle(this._handleContainer,{zIndex:MSysLayerZIndex.HANDLE_CONTAINER,width:0,height:0}),this._iwContainer=MElement.create$("div").setAttr("id","iwContainer").appendTo(this._mapContainer),this._setContainerStyle(this._iwContainer,{zIndex:MSysLayerZIndex.IW_CONTAINER,width:0,height:0}),this._panelContainer=MElement.create$("div").setAttr("id","panelContainer").appendTo(this._$dom),this._setContainerStyle(this._panelContainer,{zIndex:MSysLayerZIndex.PANEL_CONTAINER,width:0,height:0}),this._pinPanelContainer=MElement.create$("div").setAttr("id","pinPanelContainer").appendTo(this._panelContainer),this._setContainerStyle(this._pinPanelContainer,{zIndex:0,width:0,height:0}),this._floatPanelContainer=MElement.create$("div").setAttr("id","floatPanelContainer").appendTo(this._panelContainer),this._setContainerStyle(this._floatPanelContainer,{zIndex:1,width:0,height:0})},MMap.prototype._addCopyright=function(){this.addPanel(new MCopyright(this._copyrightOpts))},MMap.prototype._addStandardControl=function(){this.addPanel(new MStandardControl(this._standardControlOpts))},MMap.prototype._setDefaultStyle=function(){this._$dom.setCss({position:"relative",overflow:"hidden",padding:0,backgroundColor:this._backgroundColor,"user-select":"none"})},MMap.prototype._getPixel=function(t,i,e){return this.isEnabledDynamicMap()?this._getDynamicPixel.apply(this,arguments):this._getDefaultPixel.apply(this,arguments)},MMap.prototype._getDefaultPixel=function(t,i,e){if(t instanceof MPoint){i=i||this._center;var o,n,s,a,r,h=Math.round(1e6*i.lng-1e6*t.lng)/1e6,l=Math.round(1e6*t.lat-1e6*i.lat)/1e6;return void 0===e?(o=this._scaleX,n=this._scaleY,s=this._offset):(o=MMap.lngStep(e)/MConfig.gridWidth,n=MMap.latStep(e)/MConfig.gridHeight,s=-MConfig.standardSafe[e]),a=Math.round(h/o),r=Math.round(l/n)+s,new MPixel(Math.round(this._ctrX-a),Math.round(this._ctrY-r))}return null},MMap.prototype._getPoint=function(t,i,e){return this.isEnabledDynamicMap()?this._getDynamicPoint.apply(this,arguments):this._getDefaultPoint.apply(this,arguments)},MMap.prototype._getDefaultPoint=function(t,i,e){if("number"!=typeof t.x||"number"!=typeof t.y)return null;i=i||this.center();var o=Math.round(this._ctrX-t.x),n=Math.round(this._ctrY-t.y),s=Math.round(this.lngStep(e)/MConfig.gridWidth*o*1e6)/1e6,a=Math.round(this.latStep(e)/MConfig.gridHeight*n*1e6)/1e6,r=Math.round(1e6*i.lng-1e6*s)/1e6,h=Math.round(1e6*i.lat+1e6*a)/1e6;return new MPoint(r,h)},MMap.prototype._centerAndZoom=function(t,i,e){if(e=MTools.ifUndefined(e,!0),t instanceof MPoint&&"number"==typeof i){var o=!t.equals(this._center),n=i>=this._minZoom&&i<=this._maxZoom&&i!==this._zoom,s=this.bounds().contains(t),a=this.toPixel(t);if(!n&&o&&s&&e)this._dragPixel[0]=new MPixel(0,0),this._dragPixel[1]=new MPixel(0,0),this._dragPixelBak=this._dragPixel[1].clone(),this._prepareSlidePan(),this._startSlide({x:this._ctrX-a.x,y:this._ctrY-a.y},{x:0,y:0});else if(n&&s&&e){var r=a.x-this._ctrX,h=a.y-this._ctrY,l=this.lngStep(i)/this.lngStep(this._zoom),p=this.latStep(i)/this.latStep(this._zoom),_=Math.round(r/(l-1)),d=Math.round(h/(p-1)),c=this._ctrX-_,u=this._ctrY-d;this._startZoom(i,new MPixel(c,u))}else this._redrawMap(t,i)}},MMap.prototype._redrawMap=function(t,i,e){var o=this._setCenter(t),n=this._setZoom(i),s=this._setSize(e);(n||o||s)&&(this._mapBackground.show(),(n||o)&&(this._clearGrid(),this._mapImgLayer.setCss3({"transform-origin":"",transition:"",transform:"scale(1)"})),this._buildGrid(!0)),this._rePaintOverlay()},MMap.prototype._refreshBackground=function(){MTools.timeout(this,function(){var t=this._mapBgContext.canvas;this._mapBgContext.clearRect(-t.width,-t.height,2*t.width,2*t.height),this._mapBackground.sync()},10)},MMap.prototype._clearUpGrid=function(){var t,i=this.bounds();for(var e in this._grids)t=this._grids[e],i.intersects(t.bounds())||this._removeGrid(t)},MMap.prototype._clearGrid=function(){this._removeGrid(this.grids())},MMap.prototype._buildGrid=function(t,i){this.isEnabledDynamicMap()?this._buildDynamicGrid.apply(this,arguments):this._buildDefaultGrid.apply(this,arguments)},MMap.prototype._buildDefaultGrid=function(t,i){if(t||!this._gridComplete&&!this._timerRun){this._timerRun=!0;var e,o=i||this.bounds(),n=this._zoom,s=this._center,a=MMap.lngStep(n),r=MMap.latStep(n),h=this._scaleX,l=this._scaleY,p=[],_=[];if(this._dragging){if(this._dragedPixel){var d=this._dragedPixel,c=d.x,u=d.y,M=c*h,f=u*l,m=o.min.lng-M,g=o.min.lat+f,y=o.max.lng-M,v=o.max.lat+f;o=new MBounds(new MPoint(m,g),new MPoint(y,v)),s=o.mid()}}else for(var w in this._grids)MEvent.trigger(this,"grid_updated",this._grids[w]);for(var x=0;x<=this._maxCol;x++)for(var P=0;P<=this._maxRow;P++)if(0!==x||0!==P){p=0===x?[s.lng]:[Math.round(1e6*s.lng+x*a*1e6)/1e6,Math.round(1e6*s.lng-x*a*1e6)/1e6],_=0===P?[s.lat]:[Math.round(1e6*s.lat+P*r*1e6)/1e6,Math.round(1e6*s.lat-P*r*1e6)/1e6];for(var C=0,b=p.length;C<b;C++)for(var T=0,S=_.length;T<S;T++)e=new MGrid(new MPoint(p[C],_[T]),this),o.isIntersect(e.bounds())&&this._addGrid(e)}else this._addGrid(new MGrid(s,this));this._gridComplete=!0,this._zoomChange=!1,this._timerRun=!1}},MMap.prototype._startSlide=function(t,i,e){var o=i.x-t.x,n=i.y-t.y,s=600,a=Math.sqrt(o*o+n*n)/s;this._panAnime?this._panAnime.runing()&&this._panAnime.stop(!0):(this._panAnime=new MAnime({method:MTools.tween.Cubic.easeInOut}),MEvent.bind(this._panAnime,"changed",this._easeMove,this),MEvent.bind(this._panAnime,"stoped",this._stopDrag,this)),0!==e&&(e=e||a),this._panAnime.setBegins(i),this._panAnime.setEnds(t),this._panAnime.setDuration(e),this._panAnime.start()},MMap.prototype._addGrid=function(t){var i=t.id();this._grids[i]||(this._grids[i]=t,MEvent.trigger(this,"grid_created",t,this._dragging?MGridEventAction.DRAGGING:MGridEventAction.NORMAL))},MMap.prototype._removeGrid=function(t){if(t instanceof Array)for(var i=0,e=t.length;i<e;i++)this._removeGrid(t[i]);else if(t&&(t instanceof MGrid||"string"==typeof t)){var o=t instanceof MGrid?t.id():t,n=this._grids[o];delete this._grids[o],MEvent.trigger(this,"grid_removed",n)}},MMap.prototype._updateData=function(){var t=this.size();this._offset=-MConfig.standardSafe[this._zoom],this._scaleX=this.lngStep()/MConfig.gridWidth,this._scaleY=this.latStep()/MConfig.gridHeight,this._maxCol=Math.ceil(t.width/MConfig.gridWidth/2),this._minCol=-this._maxCol,this._maxRow=Math.ceil(t.height/MConfig.gridHeight/2),this._minRow=-this._maxRow,this._ctrX=Math.round(t.width/2),this._ctrY=Math.round(t.height/2)},MMap.prototype._bindEvent=function(){this._supportGestureEvent=MEvent.eventSupported("gesturestart",document.body),MEvent.eventSupported("touchstart",document.body)?(this._$dom.touchstart(this._startDrag,this,{evtMode:"t"}),this._$dom.touchmove(this._drag,this,{evtMode:"t",evt:"touchmove"}),this._$dom.touchend(this._endDrag,this,{evtMode:"t"}),this._$dom.bind("gesturestart",this._gestureStart,this),this._$dom.bind("gesturechange",this._gestureChange,this),this._$dom.bind("gestureend",this._gestureEnd,this)):(this._$dom.click(this._click,this),this._$dom.dblclick(this._doubleClick,this),this._$dom.mousedown(this._startDrag,this,{evtMode:"m"}),this._$dom.mouseup(this._endDrag,this,{evtMode:"m"}),this._$dom.mousemove(this._drag,this,{evtMode:"m",evt:"mousemove"}),this._$dom.mousewheel(this._mouseWheel,this)),MEvent.bind(window,"unload",this.finalize,this)},MMap.prototype._touchStartVector=0,MMap.prototype._getTouchVector=function(t,i){var e=Math.abs(t.clientX-i.clientX),o=Math.abs(t.clientY-i.clientY);return Math.sqrt(e*e+o*o)},MMap.prototype._touchGestureStart=function(t){this._supportGestureEvent||this._disablePinchToZoom||(this._touchStartVector=this._getTouchVector(t.touches[0],t.touches[1]),this.startScaleZoom())},MMap.prototype._touchGestureEnd=function(t){this._supportGestureEvent||this._disablePinchToZoom||(this._startedGesture=!1,this._justGesture=!0,this._touchStartVector=0,this.endScaleZoom())},MMap.prototype._touchGestureChange=function(t){if(!this._supportGestureEvent&&!this._disablePinchToZoom){var i=t.touches[0],e=t.touches[1],o=Math.abs(i.clientX+e.clientX)/2,n=Math.abs(i.clientY+e.clientY)/2,s=this._getTouchVector(i,e),a=new MPixel(o,n);this.scaleZoom(a,s/this._touchStartVector)}},MMap.prototype._updateDragData=function(t,i,e){e&&(this._dragTime.length=0,this._dragPositions.length=0),this._dragTime.push(t),this._dragPositions.push(i),this._dragTime.length>5&&(this._dragTime.shift(),this._dragPositions.shift())},MMap.prototype._startDrag=function(t){t.preventDefault(),t.stopPropagation(),this._draged=!1,this._touchPixel=void 0,this._justGesture=!1;var i,e=t.e,o="m"===t.data.evtMode,n=o?this._getMousePosition(e):this._getTouchPosition(e.changedTouches[0]);return e.touches&&e.touches.length>=2?void this._touchGestureStart(e):void(this._startedGesture||(this._touchPixel=n.clone(),i=this.toPoint(n),this._disableDragging||(this._startedDrag=!0,this._dragScrolling&&this._dragAnime&&(this._dragAnime.stop(),this._dragScrolling=!1),!this._disableIntertialDragging&&this._updateDragData((new Date).getTime(),n,!0),o||(e.timeStamp-this._touchstartTime>200||!this._touchstartTime||Math.abs(this._downx-n.x)>10||Math.abs(this._downy-n.y)>10?this._touchstartTime=e.timeStamp:(clearTimeout(this._touchTimer),this._doubleClick({},n))),this._downx=n.x,this._downy=n.y,this._dragPixel[0]=n,MEvent.trigger(this,"dragstart",n,i))))},MMap.prototype._endDrag=function(t){t.preventDefault(),t.stopPropagation();var i=t.e,e="m"==t.data.evtMode,o=e?this._getMousePosition(i):this._getTouchPosition(i.changedTouches[0]);if(this._touchGestureEnd(i),!this._zooming){if(!this._draged)return this._startedDrag=!1,!e&&this._touchPixel&&o&&Math.abs(this._touchPixel.x-o.x)<=5&&Math.abs(this._touchPixel.y-o.y)<=5&&this._triggerClickEvent(o),void(this._touchPixel=null);if(this._startedGesture||this._justGesture)return void(this._dragging=!1);if(e&&!this._disableDragging||!e&&!this._disableDragging&&this._draged)if(this._startedDrag=!1,this._disableIntertialDragging)this._stopDrag();else{this._updateDragData((new Date).getTime(),o);var n=this._dragTime.length-1,s=this._dragTime[n]-this._dragTime[0],a=this._dragTime[n]-this._dragTime[n-1],r=this._dragPositions[n].x-this._dragPositions[0].x,h=this._dragPositions[n].y-this._dragPositions[0].y,l=Math.round(Math.sqrt(r*r+h*h)/s*100)/100;if(a<40&&s<100){var p=Math.round(r*l*.3),_=Math.round(h*l*.3);this._dragPixelBak=this._dragPixel[1].clone(),this._startSlideMove({x:p,y:_},{x:0,y:0},Math.round(s*l/10*1.5)/100)}else this._stopDrag()}else this._stopDrag()}},MMap.prototype._stopDrag=function(){this._startedDrag=!1,this._dragging=!1,this._draged=!1,this._dragging=!1,this._resumeMap()},MMap.prototype._drag=function(t){t.preventDefault(),t.stopPropagation();var i,e=t.e,o="m"===t.data.evtMode;return e.touches&&e.touches.length>=2?void this._touchGestureChange(e):(i=o?this._getMousePosition(e):this._getTouchPosition(e.changedTouches[0]),this._mousex=i.x,this._mousey=i.y,void(this._startedGesture||this._justGesture||this._startedDrag&&(this._dragPixel[1]=i,this._draged||this._prepareSlidePan())))},MMap.prototype._prepareSlidePan=function(){this._draged=!0,this._dragging=!0,this._gridComplete=!1,window.requestAnimationFrame(this._getDragInterval()),MTools.timeout(this,function(){this._mapBackground.empty()},0)},MMap.prototype._getDragInterval=function(){return this._di||(this._di=this._dragInterval.bind(this)),this._di},MMap.prototype._dragInterval=function(){var t=this._dragPixel[0],i=this._dragPixel[1],e=this._dragPixel[2];this._draged&&(t instanceof MPixel&&i instanceof MPixel&&!i.equals(e)&&(this._dragedPixel=new MPixel(Math.round(i.x-t.x),Math.round(i.y-t.y)),!this._disableIntertialDragging&&this._updateDragData((new Date).getTime(),this._dragPixel[1]),this._mapContainer.setCss({top:this._dragedPixel.y+"px",left:this._dragedPixel.x+"px"}),this._dragPixel[2]=this._dragPixel[1],this._autoLoadOfPan&&this._buildGrid(!0),MEvent.trigger(this,"dragging",new MPixel(i.x-t.x,i.y-t.y))),window.requestAnimationFrame(this._getDragInterval()))},MMap.prototype._paintOverlay=function(t){var i=t instanceof MPixel?t:this._dragedPixel;MElement.$$([this._canvasContainer,this._shadowContainer,this._iwContainer,this._markerContainer,this._pinPanelContainer]).setCss({top:i.y+"px",left:i.x+"px"})},MMap.prototype._click=function(t){if(this._dragging||this._draged)this._dragScrolling||(this._dragging=!1);else{var i=t.e,e=this._getMousePosition(i);this._triggerClickEvent(e)}},MMap.prototype._triggerClickEvent=function(t){this._closeInfoWindowOnMapClick&&this.closeInfoWindow(),MEvent.trigger(this,"click",t,this.toPoint(t))},MMap.prototype._triggerGeoStartEvent=function(t){MEvent.trigger(this,"geo_start",this._geoData)},MMap.prototype._doubleClick=function(t,i){var e=t.e,o=i||this._getMousePosition(e);if(!this._disableDoubleClickZoom&&!this._zooming&&this._zoom<this._maxZoom){var n=this._zoom+1;this._startZoom(n,o)}MEvent.trigger(this,"dblclick",o,this.toPoint(o))},MMap.prototype._mouseWheel=function(t){t.preventDefault(),t.stopPropagation();var i=t.e,e=this._getMousePosition(i),o=this.zoom()+i.delta;o<=this._maxZoom&&o>=this._minZoom&&this._startZoom(o,e)},MMap.prototype._gestureStart=function(t){this._disablePinchToZoom||this.startScaleZoom()},MMap.prototype._gestureChange=function(t){if(!this._disablePinchToZoom){var i=t.e,e=this._getTouchPosition(i);this._dragedPixel instanceof MPixel&&(e=new MPixel(e.x-this._dragedPixel.x,e.y-this._dragedPixel.y)),this.scaleZoom(e,i.scale)}},MMap.prototype._gestureEnd=function(t){this._disablePinchToZoom||(this._startedGesture=!1,this._justGesture=!0,this.endScaleZoom())},MMap.prototype._getZoomByScale=function(t){if(1===t||Math.abs(t-1)<.2)return this._zoom;var i,e=MConfig.lngSteps.concat(),o=e[this._zoom],n=o/t,s=this._zoom;if(t>1){for(var a=0,r=e.length;a<r;a++)if(i=e[a],i<n){s=a;break}}else for(var h=e.length-1;h>=0;h--)if(i=e[h],i>n){s=h;break}return s},MMap.prototype._getZoomScale=function(t,i){return MConfig.lngSteps[t]/MConfig.lngSteps[i]},MMap.prototype.startScaleZoom=function(){this._startedGesture=!0,this._showOverlayLayers(!1),this._mapBackground.setCss({top:0,left:0}),this._scaleTimer=MTools.interval(this,this._scaleZoom,0)},MMap.prototype.endScaleZoom=function(){window.clearInterval(this._scaleTimer);var t,i,e,o,n,s,a,r,h,l=MConfig.lngSteps,p=this._size,_=new MPixel(Math.round(p.width/2),Math.round(p.height/2)),d=this._scaleNote.start,c=this._scaleNote.pixel[1],u=this._scaleNote.scale[1];c&&u&&(r=this._getZoomByScale(u),u=Math.round(l[this._zoom]/l[r]*1e6)/1e6,t=new MPixel(Math.round(d.x-c.x),Math.round(d.y-c.y)),this._scaleNote.scale[0]=u,this._scaleZoom(),o=new MPixel(Math.round(_.x-d.x),Math.round(_.y-d.y)),n=Math.round(o.x*(1-u)/u),s=Math.round(o.y*(1-u)/u),i=Math.round(t.x/u),e=Math.round(t.y/u),a=new MPixel(Math.round(_.x+n+i),Math.round(_.y+s+e)),h=this._getPoint(a),this._mapBackground.html(this._mapImgLayer.html()).show(),this._dragedPixel&&this._mapBackground.setCss3({top:this._dragedPixel.y+"px",left:this._dragedPixel.x+"px"}),this._mapImgLayer.setCss({top:0,left:0}).setCss3({transform:"translate(0,0) scale(1)"}),this._centerAndZoom(h,r,!1)),this._showOverlayLayers(),this._scaleZoomed=!1,this._scaleNote.start=null,this._scaleNote.pixel=[null,null],this._scaleNote.scale=[null,null],this._dragging&&(this._startedDrag=!1,this._dragging=!1,this._draged=!1,this._dragging=!1,this._resumeMap())},MMap.prototype._scaleZoom=function(){this._scaleZoomed||(this._scaleZoomed=!0);var t,i,e=this._scaleNote.pixel,o=this._scaleNote.scale,n=this._scaleNote.start,s=e[0],a=o[0];s&&(t=Math.round((s.x-n.x)/a),i=Math.round((s.y-n.y)/a)),!s||!a||s.equals(e[1])&&a===o[1]||(this._mapImgLayer.setCss3({"transform-origin":n.x+"px "+n.y+"px",transition:"",transform:"scale("+a+") translate("+t+"px,"+i+"px)"}),this._mapBackground.setCss3({"transform-origin":n.x+"px "+n.y+"px",transform:"scale("+a+") translate("+t+"px,"+i+"px)"}).hide(),this._scaleNote.pixel[1]=this._scaleNote.pixel[0].clone(),this._scaleNote.scale[1]=this._scaleNote.scale[0])},MMap.prototype._startZoom=function(t,i){this.isEnabledDynamicMap()?this._startDynamicZoom.apply(this,arguments):this._startDefaultZoom.apply(this,arguments)},MMap.prototype._startDefaultZoom=function(t,i){if(!(this._zooming||this._dragging||t>this._maxZoom||t<this._minZoom)){this._showOverlayLayers(!1),this._zooming=!0;var e=MConfig.gridWidth,o=MConfig.gridHeight,n=this._getPoint(i),s=Math.round(this._ctrX-i.x),a=Math.round(this._ctrY-i.y),r=Math.round(s*MMap.lngStep(t)/e*1e6)/1e6,h=Math.round(a*MMap.latStep(t)/o*1e6)/1e6,l=Math.round(1e6*n.lng+1e6*r)/1e6,p=Math.round(1e6*n.lat-1e6*h)/1e6;this._zoomedCenter=new MPoint(l,p),this._zoomedLevel=t,this._refPixel=i,this._zoomScale=MMap.lngStep(this._zoom)/MMap.lngStep(t),this._startEaseZoom(t,i)}},MMap.prototype._startEaseZoom=function(t,i){MTools.browser.android&&parseInt(MTools.browser.android.split(".")[0])<4?MMap.prototype._startEaseZoom=function(t,i){this._mapBackground.setCss({top:0,left:0}),this._zoomAnime||(this._zoomAnime=new MAnime({method:MTools.tween.Cubic.easeInOut}),MEvent.bind(this._zoomAnime,"changed",this._easeZoom,this,{refPixel:i}),MEvent.bind(this._zoomAnime,"stoped",this._endEaseZoom,this)),this._zoomAnime.setBegins({s:1}),this._zoomAnime.setEnds({s:this._zoomScale}),this._zoomAnime.setDuration(.3),this._mapImgLayer.setCss3({"transform-origin":i.x+"px "+i.y+"px",transition:""}),this._mapBackground.hide().setCss3({"transform-origin":i.x+"px "+i.y+"px",transform:"scale("+this._zoomScale+")"}).html(this._mapImgLayer.html()),this._zoomAnime.start()}:MMap.prototype._startEaseZoom=function(t,i){this._mapBackground.setCss({top:0,left:0}),this._mapImgLayer.setCss3({"transform-origin":i.x+"px "+i.y+"px",transition:"all 0.3s ease-in-out",transform:"scale("+this._zoomScale+")"}),this._mapBackground.hide().setCss3({"transform-origin":i.x+"px "+i.y+"px",transform:"scale("+this._zoomScale+")"}).html(this._mapImgLayer.html()),MEvent.one(this._mapImgLayer.get(0),MEvent.Events.transitionend,function(){this._endEaseZoom()},this)},this._startEaseZoom(t,i)},MMap.prototype._easeZoom=function(t,i,e){this._mapImgLayer.setCss3({transform:"scale("+i.s+")"})},MMap.prototype.scaleZoom=function(t,i){!this._scaleNote.start&&(this._scaleNote.start=t.clone());var e=MConfig.lngSteps,o=e[this._zoom]/i,n=e[this._minZoom],s=e[this._maxZoom];this._scaleNote.pixel[0]=t,o<n&&o>s&&(this._scaleNote.scale[0]=i)},MMap.prototype._endEaseZoom=function(t){this._showOverlayLayers(),this._redrawMap(this._zoomedCenter,this._zoomedLevel),MTools.timeout(this,function(){this._zooming=!1},200)},MMap.prototype._startSlideMove=function(t,i,e){var o=this,n=i.x-t.x,s=i.y-t.y;this._dragAnime?this._dragAnime.stop():(this._dragAnime=new MAnime({method:MTools.tween.Quad.easeOut}),MEvent.bind(this._dragAnime,"changed",this._easeMove,this),MEvent.bind(this._dragAnime,"stoped",function(){o._dragScrolling=!1,o._stopDrag()},this)),e=e||Math.sqrt(n*n+s*s)/500,this._dragAnime.setBegins(i),this._dragAnime.setEnds(t),this._dragAnime.setDuration(e),this._dragAnime.start(),this._dragScrolling=!0},MMap.prototype._easeMove=function(t,i){var e=this._dragPixelBak;this._gridComplete=!1,e instanceof MPixel?this._dragPixel[1]=new MPixel(Math.round(e.x+i.x),Math.round(e.y+i.y)):this._dragPixel[1]=new MPixel(Math.round(i.x),Math.round(i.y))},MMap.prototype._resumeMap=function(){var t=this._dragedPixel,i=t?t.x:0,e=t?t.y:0,o=this.size(),n=new MPixel(Math.round(o.width/2-i),Math.round(o.height/2-e));this._setCenter(this.toPoint(n)),this._buildGrid(!0),this._mapContainer.setCss({top:0,left:0}),this._rePaintOverlay(),this._dragedPixel=null,MEvent.trigger(this,"dragend",n,this._center),MTools.timeout(this,function(){this._clearUpGrid()},0)},MMap.prototype._rePaintOverlay=function(){for(var t in this._overlays)this._overlays[t].paint();this._geoMarker&&this._geoMarker.paint(),this._geoRange&&this._showLocationRange();for(var i in this._infoWindows)this._infoWindows[i].owner()||this._infoWindows[i].paint();for(var e in this._panels)this._panels[e]instanceof MPinPanel&&this._panels[e].paint()},MMap.prototype._setZoom=function(t){return"number"==typeof t&&t>=this._minZoom&&t<=this._maxZoom&&t!==this._zoom&&(this._zoom=t,this._updateData(),MEvent.trigger(this,"zoom_changed",this._zoom),!0)},MMap.prototype._setCenter=function(t){if(t instanceof MPoint&&!t.equals(this._center)){var i=t.lng>360?t.lng-360:t.lng<0?360+t.lng:t.lng,e=t.lat>90?90:t.lat<-90?-90:t.lat;return this._center=new MPoint(i,e),MEvent.trigger(this,"center_changed",this._center),!0}return!1},MMap.prototype._setSize=function(t){return t instanceof MSize&&!this._size.equals(t)&&(this._size=t.clone(),this._setContainerSize(),this._updateData(),MEvent.trigger(this,"resize",this._size.clone()),!0)},MMap.prototype._getBounds=function(t,i){var e=this.size(),o=new MPixel(0,e.height),n=new MPixel(e.width,0);return new MBounds(this._getPoint(o,t,i),this._getPoint(n,t,i))},MMap.prototype._getMousePosition=function(t){if(t&&void 0!==t.pageX&&void 0!==t.pageY){var i=this._$dom.offset();return new MPixel(t.pageX-i.x,t.pageY-i.y)}return null},MMap.prototype._getTouchPosition=function(t){if(t&&void 0!==t.pageX&&void 0!==t.pageY){var i=this._$dom.offset();return new MPixel(t.pageX-i.x,t.pageY-i.y)}return null},MMap.prototype._startBuildGrids=function(){this._interval=MTools.interval(this,this._buildGrid,0)},MMap.prototype._setContainerStyle=function(t,i){var e=this.size(),o={position:"absolute",top:0,left:0,padding:0,margin:0,width:e.width+"px",height:e.height+"px"};o=MTools.extend(o,i),t.setCss(o)},MMap.prototype._showOverlayLayers=function(t){t=MTools.ifTypeOf(t,"boolean",!0),t=t?"block":"none",MElement.$$([this._markerContainer,this._shadowContainer,this._canvasContainer,this._layersContainer,this._iwContainer,this._pinPanelContainer]).setCss("display",t)},MMap.prototype._setContainerSize=function(){var t=this._size.width,i=this._size.height;MElement.$$([this._$dom,this._mapContainer,this._mapBackground]).setCss({width:t+"px",height:i+"px"}),this._svgContainer&&this._svgContainer.setAttr({viewBox:[-t,-i,3*t,3*i].join(" "),height:3*i,width:3*t}).setCss({top:-i+"px",left:-t+"px"})},MMap.prototype._addOverlay=function(t,i){t instanceof MOverlay&&(t.setMap(this),i||(this._overlays[t.id()]=t,this._filterOverlay(t)),t.paint())},MMap.prototype._filterOverlay=function(t){(t instanceof MCircle||t instanceof MPolyline)&&(this._vectors[t.id()]=t)},MMap.prototype._startLocation=function(t,i){var e,o=this;return e=navigator.geolocation[t](function(){o._geoSuccess.apply(o,arguments)},function(){o._geoFailed.apply(o,arguments)},{enableHighAccuracy:!!i,maximumAge:3e3,timeout:6e5})},MMap.prototype._encodeGeoServiceData=function(t,i){var e=(new Date).getTime().toString().substring(0,3),o="55"+this._zoom,n=o.substring(o.length-2),s=new MPoint(t,i),a=new MGrid(s,this);o="000000"+a.a_grid_x();var r=o.substring(o.length-6);o="000000"+a.a_grid_y();var h=o.substring(o.length-6),l=a.a_grid_x()*this.lngStep(),p=a.a_grid_y()*this.latStep(),_=this.toPixel(s),d=this.toPixel(new MPoint(l,p));o=_.x-d.x,o<100&&(o+=900);var c=o.toString();o=d.y-_.y,o<100&&(o+=900);var u=o.toString();return{city:"iprule",t:e+n+r+h+c+u,h:this._enabledHighResolution?1:0}},MMap.prototype._decodeGeoServiceResult=function(t){if(t.t){var i=t.t,e=3,o=i.substring(e,e+2);"5"===o.substring(0,1)&&(o=o.substring(1)),o=parseInt(o),o>this._maxZoom&&(o=this._maxZoom),o<this._minZoom&&(o=this._minZoom),e+=2;var n=parseInt(i.substring(e,e+6),10);e+=6;var s=parseInt(i.substring(e,e+6),10);e+=6;var a=parseInt(i.substring(e,e+3),10);a>900&&(a-=900),e+=3;var r=parseInt(i.substring(e,e+3),10);r>900&&(r-=900);var h=n*this.lngStep(o),l=s*this.latStep(o),p=new MPoint(h,l),_=this.toPixel(p);return this.toPoint(_.x+a,_.y-r)}},MMap.prototype._geoSuccess=function(t){var i=t.coords,e=i.latitude,o=i.longitude,n=i.accuracy,s=i.speed,a=i.heading,r=i.altitude,h=i.altitudeAccuracy;MTools.JSONP({url:"http://geocode.mapbar.com/decode/getWeatherByCity.jsp",data:this._encodeGeoServiceData(o,e),context:this,success:function(t){var i=this._decodeGeoServiceResult(t);if(this._setGeoData(i,n),n<=this._validAccuracy){var e=n/111111,o=e,l=new MBounds(new MPoint(i.lng-o,i.lat-e),new MPoint(i.lng+o,i.lat+e));this._enabledPositionMark&&(this.intoView(l),this.setCenter(i),this._showLocation(i),this._showLocationRange()),this.geoSuccess({point:i,accuracy:n,bounds:l,speed:s,heading:a,altitude:r,altitudeAccuracy:h})}else this.geoFailed({error:"accuracy too low"})},error:function(){this.geoFailed({error:"timeout"})}})},MMap.prototype._geoFailed=function(t){this.geoFailed({error:t})},MMap.prototype._showLocation=function(t){this._geoMarker?this._geoMarker.setPoint(t):(this._geoMarker=this._defaultLocationMarker?this._defaultLocationMarker:new MMarker(t,{icon:new MImgIcon("http://img.mapbar.com/maplite/images/stdmobile.png",{anchor:new MPixel(7,7),size:new MSize(13,13),offset:new MPixel((-124),(-1))})}),this._addOverlay(this._geoMarker,!0))},MMap.prototype._setGeoData=function(t,i){this._geoPoint=t instanceof MPoint?t:void 0,this._geoAccuracy="number"==typeof i?i:void 0},MMap.prototype._showLocationRange=function(){if(this._geoPoint instanceof MPoint&&"number"==typeof this._geoAccuracy&&(this._geoRange||(this._geoRange=MElement.create$("canvas").setAttr({width:this._size.width,height:this._size.height}).appendTo(this._canvasContainer).get(0)),this._geoRange.getContext)){var t=this._geoAccuracy/111111,i=this._geoRange.getContext("2d"),e=new MPoint(this._geoPoint.lng,this._geoPoint.lat-t),o=this.toPixel(this._geoPoint),n=this.toPixel(e),s=n.y-o.y;MTools.clearCanvas(i),MTools.paintCircle(i,o,s,!0,!0,{fillStyle:"rgba(39, 123, 255, 0.3)",strokeStyle:"rgba(0, 63, 232, 0.3)",lineWidth:1})}},MMap.prototype._setMaxZoom=function(t,i,e,o){var n=this._minZoom,s=MConfig.maxZoom,a=MConfig.minZoom;this._maxZoom="number"==typeof t?Math.min(t,s):s,e||(this._maxZoom=Math.max(this._maxZoom,n||a)),!i&&this.zoom()>this._maxZoom&&this.setZoom(this._maxZoom),!o&&MEvent.trigger(this,"zoomRange_change",this._minZoom,this._maxZoom)},MMap.prototype._setMinZoom=function(t,i,e,o){var n=this._maxZoom,s=MConfig.maxZoom,a=MConfig.minZoom;this._minZoom="number"==typeof t?Math.max(t,a):a,e||(this._minZoom=Math.min(this._minZoom,n||s)),!i&&this.zoom()<this._minZoom&&this.setZoom(this._minZoom),!o&&MEvent.trigger(this,"zoomRange_change",this._minZoom,this._maxZoom)},MMap.prototype._isInBorderRange=function(t,i,e,o,n){var s=!1,a=t.x,r=t.y,h=new MPoint(o.min.lng,o.max.lat),l=new MPoint(o.max.lng,o.max.lat),p=new MPoint(o.max.lng,o.min.lat),_=new MPoint(o.min.lng,o.min.lat),d=this._getPixel(h,n,e),c=this._getPixel(l,n,e),u=this._getPixel(p,n,e),M=this._getPixel(_,n,e),f=c.x-M.x,m=M.y-c.y;if(a>=f/2||r>=m/2)return s=!1;var g=(this._getPoint(new MPixel(d.x+a,d.y+r),n,e),this._getPoint(new MPixel(c.x-a,c.y+r),n,e)),y=(this._getPoint(new MPixel(u.x-a,u.y-r),n,e),this._getPoint(new MPixel(M.x+a,M.y-r),n,e)),v=new MBounds(y,g),w=v.containsRange(i),x=o.containsRange(i);return!1===w&&!0===x&&(s=!0),s},MMap.prototype._initOptions=function(t){this._backgroundColor=MTools.ifUndefined(t.backgroundColor,"#F4F1EC"),this._center=t.center,this._initCenter=this._center.clone(),this._disableDragging=MTools.ifUndefined(t.disableDragging,!1),this._disableIntertialDragging=MTools.ifUndefined(t.disableIntertialDragging,!1),this._enabledBackground=MTools.ifUndefined(t.enabledBackground,!0),this._zoomSteps=MTools.ifUndefined(t.zoomSteps,8),this._enabledDynamicMap=MTools.ifUndefined(t.enabledDynamicMap,!1),this._enabledHighResolution=!this._enabledDynamicMap&&MTools.ifUndefined(t.enabledHighResolution,!1),this._copyrightOpts=MTools.ifUndefined(t.copyrightOpts,{}),this._copyrightOpts.content=MConfig.copyright,this._standardControl=MTools.ifUndefined(t.standardControl,!0),this._standardControlOpts=t.standardControlOpts,this._mapImgServer=MTools.ifUndefined(t.mapImgServer,this._enabledDynamicMap?"http://img1.mapbar.com/advdynamic/02/GetPng/":"http://img[1-9].mapbar.com/maplite/mapbank/stdmobile"+(this._enabledHighResolution?"_h":"")+"/"),this._mapImgFormat=MTools.ifUndefined(t.mapImgFormat,"png"),this._defaultImgIconUrl=MTools.ifUndefined(t.defaultImgIconUrl,"http://img.mapbar.com/maplite/images/stdmobile.png"),this.setResourceUrl(t.resourceUrl),this._autoLoadOfPan=MTools.ifUndefined(t.autoLoadOfPan,!0),this._autoLoadOfZoom=MTools.ifUndefined(t.autoLoadOfZoom,!0),this._enabledGeolocation=MTools.ifUndefined(t.enabledGeolocation,!0),this._enabledPositionMark=MTools.ifUndefined(t.enabledPositionMark,!0),this._trafficImgServer=MTools.ifUndefined(t.trafficImgServer,this._enabledDynamicMap?"http://lukuang.mapbar.com/image/256/GetPng.jsp?":this._enabledHighResolution?"http://lukuang.mapbar.com/mobile/cn/300/":"http://lukuang.mapbar.com/02/"),this._allowMultiInfoWindow=MTools.ifUndefined(t.allowMultiInfoWindow,!1),this._defaultLocationMarker=t.defaultLocationMarker,this._validAccuracy=MTools.ifUndefined(t.validAccuracy,2e3),this._panMapOnOpenInfoWindow=MTools.ifUndefined(t.panMapOnOpenInfoWindow,!0),this._closeInfoWindowOnMapClick=MTools.ifUndefined(t.closeInfoWindowOnMapClick,!0),this._autoAdjustInfoWindowPosition=MTools.ifUndefined(t.autoAdjustInfoWindowPosition,!1),this._getPositionAgent=t.getPositionAgent,this._watchPositionAgent=t.watchPositionAgent,this._stopWatchPositionAgent=t.stopWatchPositionAgent,this._initConfig(t)},MMap.prototype._initConfig=function(t){if(this._enabledDynamicMap)for(var i in MDynamicConfig)MConfig[i]=MDynamicConfig[i];this._zoom=MTools.ifUndefined(t.zoom,8),this._initZoom=this._zoom,this._setMaxZoom(t.maxZoom,!0,!0),this._setMinZoom(t.minZoom,!0),this._disablePinchToZoom=MTools.ifUndefined(t.disablePinchToZoom,!1),this._disableDoubleClickZoom=MTools.ifUndefined(t.disableDoubleClickZoom,!1),this._trafficMinZoom=MTools.ifUndefined(t.trafficMinZoom,MConfig.trafficMinZoom),this._trafficMinZoom=MTools.between(this._trafficMinZoom,this._minZoom,this._maxZoom,this._minZoom),this._trafficMaxZoom=MTools.ifUndefined(t.trafficMaxZoom,this._maxZoom),this._trafficMaxZoom=MTools.between(this._trafficMaxZoom,this._minZoom,this._maxZoom,this._maxZoom)},MMap.pixelDistance=function(t,i,e){var o=parseInt(1e6*t.lng-1e6*i.lng)/1e6,n=parseInt(1e6*i.lat-1e6*t.lat)/1e6;return new MPixel((-Math.round(o/(MMap.lngStep(e)/MConfig.gridWidth))),(-Math.round(n/(MMap.latStep(e)/MConfig.gridHeight)-MConfig.standardSafe[e])));
},MMap.lngStep=function(t){return MConfig.lngSteps[t]},MMap.latStep=function(t){return MConfig.latSteps[t]},MMap.gridTCountOfLon=function(t){return parseInt(360/MConfig.lngSteps[t])},MMap.strStyle="@keyframes TILE{0%{opacity:0}100%{opacity:1}}@-webkit-keyframes TILE{0%{opacity:0}100%{opacity:1}}.mapTile{-webkit-animation:TILE 0.2s ease-in-out;animation:TILE 0.2s ease-in-out}#mapBackground .mapTile{-webkit-animation:none;animation:none}",MMap.addStyle=!1,MMap.prototype.isEnabledDynamicMap=function(){return this._enabledDynamicMap},MMap.prototype._buildDynamicGrid=function(t,i){if(t||!this._gridComplete&&!this._timerRun){this._timerRun=!0;var e,o=i||this.bounds(),n=this._zoom,s=this._center,a=MMap.LatLonToPixels(s.lng,s.lat,n),r=Math.floor(a.x/MConfig.gridWidth),h=Math.floor(a.y/MConfig.gridHeight),l=this._scaleX,p=this._scaleY,_=this._maxCol,d=this._maxRow;if(this._dragging){if(this._dragedPixel){var c=this._dragedPixel,u=c.x,M=c.y,f=u*l,m=M*p,g=o.min.lng-f,y=o.min.lat+m,v=o.max.lng-f,w=o.max.lat+m;o=new MBounds(new MPoint(g,y),new MPoint(v,w)),s=o.mid()}}else for(var x in this._grids)MEvent.trigger(this,"grid_updated",this._grids[x]);for(var P=-_-1;P<=_;P++)for(var C=-d-1;C<=d;C++){var b=(r+P)*MConfig.gridWidth,T=(h+C)*MConfig.gridHeight,S=MMap.PixelsToLatLon(b,T,n);e=new MDynamicGrid(S,this),o.isIntersect(e.bounds())&&this._addGrid(e)}this._gridComplete=!0,this._zoomChange=!1,this._timerRun=!1}},MMap.prototype._getDynamicPoint=function(t,i,e){if("number"!=typeof t.x||"number"!=typeof t.y)return null;i=i||this.center(),e=e||this.zoom();var o=MMap.LatLonToPixels(i.lng,i.lat,e),n=t.x-this._ctrX,s=t.y-this._ctrY,a=o.x+n,r=o.y+s;return MMap.PixelsToLatLon(a,r,e)},MMap.prototype._getDynamicPixel=function(t,i,e){if(t instanceof MPoint){i=i||this.center(),e=e||this.zoom();var o=MMap.LatLonToPixels(t.lng,t.lat,e),n=MMap.LatLonToPixels(i.lng,i.lat,e),s=o.x-n.x,a=o.y-n.y,r=this._ctrX+s,h=this._ctrY+a;return new MPixel(r,h)}return null},MMap.prototype._startDynamicZoom=function(t,i){if(!(this._zooming||this._dragging||t>this._maxZoom||t<this._minZoom)){this._showOverlayLayers(!1),this._zooming=!0;var e=this._getPoint(i),o=Math.round(this._ctrX-i.x),n=Math.round(this._ctrY-i.y),s=MMap.LatLonToPixels(e.lng,e.lat,t),a=s.x+o,r=s.y+n,h=this._center,l=MMap.PixelsToLatLon(a,r,t),p=o?l.lng:h.lng,_=n?l.lat:h.lat;this._zoomedCenter=new MPoint(p,_),this._zoomedLevel=t,this._refPixel=i,this._zoomScale=MMap.lngStep(this._zoom)/MMap.lngStep(t),this._startEaseZoom(t,i)}},MMap.LatLonToPixels=function(t,i,e){var o="1.5707963267948966",o=+o,n="57.295779513082323",n=+n,s=40075016.68557849/parseFloat(256*(1<<e)),a=t/n*6378137,r=6378137*-Math.log(Math.tan((o-i/n)/2)),h=parseInt(Math.round((a+20037508.342789244)/s)),l=parseInt(Math.round((20037508.342789244-r)/s));return{x:h,y:l}},MMap.PixelsToLatLon=function(t,i,e){var o="1.5707963267948966",o=+o,n="57.295779513082323",n=+n,s=40075016.68557849/parseFloat(256*(1<<e)),a=t*s-20037508.342789244,r=20037508.342789244-i*s,h=o-2*Math.atan(Math.exp(-r/6378137)),l=a/6378137;return h*=n,l*=n,new MPoint(l%360,h)};